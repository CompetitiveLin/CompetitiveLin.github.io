<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Python脚本制作coco格式的实例分割数据集" /><meta property="og:locale" content="en" /><meta name="description" content="Introdution" /><meta property="og:description" content="Introdution" /><link rel="canonical" href="/posts/make-coco-dataset/" /><meta property="og:url" content="/posts/make-coco-dataset/" /><meta property="og:site_name" content="Blogs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-04T01:42:07+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Python脚本制作coco格式的实例分割数据集" /><meta name="twitter:site" content="@CompetitiveLin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-08T00:47:45+08:00","datePublished":"2022-03-04T01:42:07+08:00","description":"Introdution","headline":"Python脚本制作coco格式的实例分割数据集","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/make-coco-dataset/"},"url":"/posts/make-coco-dataset/"}</script><title>Python脚本制作coco格式的实例分割数据集 | Blogs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Blogs"><meta name="application-name" content="Blogs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avator.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Blogs</a></div><div class="site-subtitle font-italic">Recording everything in here.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/CompetitiveLin" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/CompetitiveLin" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zee_lin','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Python脚本制作coco格式的实例分割数据集</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Python脚本制作coco格式的实例分割数据集</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1646329327" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 4, 2022 </em> </span> <span> Updated <em class="" data-ts="1646671665" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 8, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/CompetitiveLin">CompetitiveLin</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1296 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="index">Introdution</h1><p>利用labelme制作coco格式的实例分割数据集，该数据集适用于mmdetection2.0中的mask部分。</p><p>在mmdetection2.0框架下，利用coco格式的数据集进行实例分割默认只需要train2017和val2017两部分（当然也可以将test中的目录修改成test2017，但没必要）。</p><p><a href="/images/posts/3-1.png" class="popup img-link "><img data-src="/images/posts/3-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>mmdetection2.0框架下coco格式数据集文件如下图放置：（运行完本文的.py文件后即可生成以下文件夹）</p><p><a href="/images/posts/3-2.png" class="popup img-link "><img data-src="/images/posts/3-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>数据集标注方式：</p><p>当一张图片里没有多个同类别的物体，使用car,computer,bottle等标签直接进行标注；当一张图片里同个类别有多个物体时，标签采用sofa-1,sofa-2,desk-1,desk-2等标签-数字的格式进行标注；如果同一物体在遮挡情况下被分为多个部分，则不同部分都用同一个标签（具体如下图所示，牙膏的三个部分标签均为toothpaste）。</p><p><a href="/images/posts/3-3.png" class="popup img-link "><img data-src="/images/posts/3-3.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>最后得到的json文件里的segmentation是分为三部分，bbox只存在一个（在笔者找的其他资料里，都是分为三个独立的牙膏部分，得到三个segmentation以及三个相应的bbox，显然不符合实际情况）。</p><p><a href="/images/posts/3-4.png" class="popup img-link "><img data-src="/images/posts/3-4.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>建议在使用labelme进行对数据集标注时，将生成的.json文件放置在<strong>与数据集相同的路径下</strong>以避免一些不必要的麻烦。即下图：</p><p><a href="/images/posts/3-5.png" class="popup img-link "><img data-src="/images/posts/3-5.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>否则，生成的json文件里的imagePath可能出现下图所示的情况：</p><p><a href="/images/posts/3-6.png" class="popup img-link "><img data-src="/images/posts/3-6.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>如果实在是没办法，没有在同一路径下，imagePath会比较复杂（可能是windows系统用\分隔号，ubuntu系统则会是/分隔号，这一点是笔者的猜测），根据不同的情况修改后文代码。</p><h1 id="solution">Solution</h1><p>各文件夹布局如下所示：</p><p><a href="/images/posts/3-7.png" class="popup img-link "><img data-src="/images/posts/3-7.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>所有的.jpg文件放在<strong>images</strong>文件夹下，所有的.json文件（labelme标注完成后生成的文件）放在<code class="language-plaintext filepath highlighter-rouge">labelme/total2017</code>文件夹下。</p><h2 id="creat_txtpy"><span class="mr-2">creat_txt.py</span><a href="#creat_txtpy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="c1"># !/usr/bin/python
# -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="n">trainval_percent</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># No test sample
</span><span class="n">train_percent</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">jsonfilepath</span> <span class="o">=</span> <span class="sh">'</span><span class="s">labelme/total2017</span><span class="sh">'</span>
<span class="n">txtsavepath</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./</span><span class="sh">'</span>
<span class="n">total_xml</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="n">jsonfilepath</span><span class="p">)</span>

<span class="n">num</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">total_xml</span><span class="p">)</span>
<span class="nb">list</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="n">tv</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">num</span> <span class="o">*</span> <span class="n">trainval_percent</span><span class="p">)</span>
<span class="n">tr</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">tv</span> <span class="o">*</span> <span class="n">train_percent</span><span class="p">)</span>
<span class="n">trainval</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">tv</span><span class="p">)</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">trainval</span><span class="p">,</span> <span class="n">tr</span><span class="p">)</span>

<span class="n">ftrainval</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./trainval2017.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ftrain</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./train2017.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">fval</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./val2017.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ftest</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./test2017.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span>  <span class="c1">#Still create test2017.txt
</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">total_xml</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trainval</span><span class="p">:</span>
        <span class="n">ftrainval</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">train</span><span class="p">:</span>
            <span class="n">ftrain</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fval</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ftest</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">ftrainval</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="n">ftrain</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="n">fval</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="n">ftest</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Create_txt Done</span><span class="sh">'</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="classifypy"><span class="mr-2">classify.py</span><a href="#classifypy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">shutil</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">os.path</span> <span class="k">as</span> <span class="n">osp</span>

<span class="n">sets</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">train2017</span><span class="sh">'</span><span class="p">,</span>  <span class="sh">'</span><span class="s">val2017</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">test2017</span><span class="sh">'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">image_set</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">osp</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">image_set</span><span class="p">):</span>
        <span class="n">shutil</span><span class="p">.</span><span class="nf">rmtree</span><span class="p">(</span><span class="n">image_set</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Deleted previous %s file and created a new one</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="n">image_set</span><span class="p">))</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">image_set</span><span class="p">)</span>
    <span class="n">json_path</span> <span class="o">=</span> <span class="sh">'</span><span class="s">labelme/%s</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="n">image_set</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">osp</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">json_path</span><span class="p">):</span>
        <span class="n">shutil</span><span class="p">.</span><span class="nf">rmtree</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Deleted previous %s file and created a new one</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">json_path</span><span class="p">))</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span>
    <span class="n">image_ids</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">./%s.txt</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="n">image_set</span><span class="p">)).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">().</span><span class="nf">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">image_id</span> <span class="ow">in</span> <span class="n">image_ids</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="sh">'</span><span class="s">images/%s.jpg</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
        <span class="n">json</span> <span class="o">=</span> <span class="sh">'</span><span class="s">labelme/total2017/%s.json</span><span class="sh">'</span><span class="o">%</span> <span class="p">(</span><span class="n">image_id</span><span class="p">)</span>
        <span class="n">shutil</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">image_set</span><span class="p">)</span>
        <span class="n">shutil</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="sh">'</span><span class="s">labelme/%s/</span><span class="sh">'</span><span class="o">%</span> <span class="p">(</span><span class="n">image_set</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Done</span><span class="sh">"</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="labelme2cocopy"><span class="mr-2">labelme2coco.py</span><a href="#labelme2cocopy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span><span class="kn">import</span> <span class="n">collections</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">os.path</span> <span class="k">as</span> <span class="n">osp</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">PIL.Image</span>
<span class="kn">import</span> <span class="n">labelme</span>
<span class="kn">import</span> <span class="n">shutil</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="n">pycocotools.mask</span>
<span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Please install pycocotools:</span><span class="se">\n\n</span><span class="s">    pip install pycocotools</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">train2017</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">val2017</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">test2017</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./annotations</span><span class="sh">'</span>
    <span class="k">if</span> <span class="n">osp</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Output directory already exists:</span><span class="sh">'</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="p">.</span><span class="nf">rmtree</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Creating dataset:</span><span class="sh">'</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span>
        <span class="n">input_dir</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./labelme/%s</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sh">'</span><span class="s">instances_%s</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span>
            <span class="n">info</span><span class="o">=</span><span class="nf">dict</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">contributor</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">date_created</span><span class="o">=</span><span class="n">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H:%M:%S.%f</span><span class="sh">'</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">licenses</span><span class="o">=</span><span class="p">[</span><span class="nf">dict</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="p">)],</span>
            <span class="n">images</span><span class="o">=</span><span class="p">[</span>
                <span class="c1"># license, url, file_name, height, width, date_captured, id
</span>            <span class="p">],</span>
            <span class="nb">type</span><span class="o">=</span><span class="sh">'</span><span class="s">instances</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">annotations</span><span class="o">=</span><span class="p">[</span>
                <span class="c1"># segmentation, area, iscrowd, image_id, bbox, category_id, id
</span>            <span class="p">],</span>
            <span class="n">categories</span><span class="o">=</span><span class="p">[</span>
                <span class="c1"># supercategory, id, name
</span>            <span class="p">],</span>
        <span class="p">)</span>

        <span class="n">class_name_to_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">labels.txt</span><span class="sh">'</span><span class="p">).</span><span class="nf">readlines</span><span class="p">()):</span>
            <span class="n">class_id</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># starts with -1
</span>            <span class="n">class_name</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">class_id</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">class_name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__ignore__</span><span class="sh">'</span>
                <span class="k">continue</span>
            <span class="n">class_name_to_id</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_id</span>
            <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">categories</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span>
                <span class="n">supercategory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">class_id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="n">out_ann_file</span> <span class="o">=</span> <span class="n">osp</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span>  <span class="n">filename</span><span class="o">+</span><span class="sh">'</span><span class="s">.json</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">label_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="n">osp</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="sh">'</span><span class="s">*.json</span><span class="sh">'</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">label_file</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">label_files</span><span class="p">):</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">label_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">label_data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">path</span><span class="o">=</span><span class="n">label_data</span><span class="p">[</span><span class="sh">'</span><span class="s">imagePath</span><span class="sh">'</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># 可能因为windows或ubuntu不同的系统用\\或/划分,详见前言三
</span>            <span class="n">img_file</span> <span class="o">=</span> <span class="sh">'</span><span class="s">./%s/</span><span class="sh">'</span><span class="o">%</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span> <span class="o">+</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">asarray</span><span class="p">(</span><span class="n">PIL</span><span class="p">.</span><span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">img_file</span><span class="p">))</span>
            <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">images</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span>
                <span class="n">license</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">label_file</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.jpg</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">width</span><span class="o">=</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">date_captured</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">image_id</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="n">masks</span> <span class="o">=</span> <span class="p">{}</span>                                     <span class="c1"># for area
</span>            <span class="n">segmentations</span> <span class="o">=</span> <span class="n">collections</span><span class="p">.</span><span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># for segmentation
</span>            <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">label_data</span><span class="p">[</span><span class="sh">'</span><span class="s">shapes</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="sh">'</span><span class="s">points</span><span class="sh">'</span><span class="p">]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="sh">'</span><span class="s">label</span><span class="sh">'</span><span class="p">]</span>
                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">shape_type</span><span class="sh">'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">labelme</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="nf">shape_to_mask</span><span class="p">(</span>
                    <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">points</span><span class="p">,</span> <span class="n">shape_type</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">:</span>
                    <span class="n">masks</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">masks</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">|</span> <span class="n">mask</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">masks</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span>

                <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">).</span><span class="nf">flatten</span><span class="p">().</span><span class="nf">tolist</span><span class="p">()</span>
                <span class="n">segmentations</span><span class="p">[</span><span class="n">label</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">masks</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                <span class="n">cls_name</span> <span class="o">=</span> <span class="n">label</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cls_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_name_to_id</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">cls_id</span> <span class="o">=</span> <span class="n">class_name_to_id</span><span class="p">[</span><span class="n">cls_name</span><span class="p">]</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">asfortranarray</span><span class="p">(</span><span class="n">mask</span><span class="p">.</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">))</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">pycocotools</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                <span class="n">area</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">pycocotools</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="nf">area</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">pycocotools</span><span class="p">.</span><span class="n">mask</span><span class="p">.</span><span class="nf">toBbox</span><span class="p">(</span><span class="n">mask</span><span class="p">).</span><span class="nf">flatten</span><span class="p">().</span><span class="nf">tolist</span><span class="p">()</span>

                <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">annotations</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="nf">dict</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">annotations</span><span class="sh">'</span><span class="p">]),</span>
                    <span class="n">image_id</span><span class="o">=</span><span class="n">image_id</span><span class="p">,</span>
                    <span class="n">category_id</span><span class="o">=</span><span class="n">cls_id</span><span class="p">,</span>
                    <span class="n">segmentation</span><span class="o">=</span><span class="n">segmentations</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
                    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span>
                    <span class="n">iscrowd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">))</span>

        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">out_ann_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="nb">set</span> <span class="o">+</span> <span class="sh">'</span><span class="s"> is done</span><span class="sh">'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div><p>上述三个文件按顺序执行即可。</p><p>最后所有的文件夹如下图所示，如<a href="#index">前文</a>所提到的，在mmdetection中被利用到的只有annotations,train2017,val2017三个文件夹。</p><p><a href="/images/posts/3-8.png" class="popup img-link "><img data-src="/images/posts/3-8.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>本文的代码可以反复运行，因为代码中包含一些旧文件夹的删除以及新建，不会报错。</p><h1 id="reference">Reference</h1><ol><li><a href="https://github.com/spytensor/prepare_detection_dataset">prepare_detection_dataset</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/script/'>Script</a>, <a href='/categories/python/'>Python</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mmdetection/" class="post-tag no-text-decoration" >mmdetection</a> <a href="/tags/labelme/" class="post-tag no-text-decoration" >labelme</a> <a href="/tags/coco/" class="post-tag no-text-decoration" >coco</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Python%E8%84%9A%E6%9C%AC%E5%88%B6%E4%BD%9Ccoco%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E9%9B%86%20-%20Blogs&url=%2Fposts%2Fmake-coco-dataset%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Python%E8%84%9A%E6%9C%AC%E5%88%B6%E4%BD%9Ccoco%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E9%9B%86%20-%20Blogs&u=%2Fposts%2Fmake-coco-dataset%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fmake-coco-dataset%2F&text=Python%E8%84%9A%E6%9C%AC%E5%88%B6%E4%BD%9Ccoco%E6%A0%BC%E5%BC%8F%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E9%9B%86%20-%20Blogs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/elasticsearch/">ElasticSearch</a><li><a href="/posts/note-from-work/">Note from Work</a><li><a href="/posts/redis/">Redis 知识体系</a><li><a href="/posts/springboot/">SpringBoot</a><li><a href="/posts/go/">Go 语言学习</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/get-hsv-and-bgr/"><div class="card-body"> <em class="small" data-ts="1646372149" data-df="ll" > Mar 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python实现点击图片获取HSV或BGR的值</h3><div class="text-muted small"><p> 单击图片即可得到HSV或BGR的值，代码如下： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import cv2 def getposHsv(event, x, y, flags, param): if event == cv2.EVENT_LBUTTONDOWN: print(&quot;HSV is&quot;, HSV[y, x]) d...</p></div></div></a></div><div class="card"> <a href="/posts/zookeeper/"><div class="card-body"> <em class="small" data-ts="1723341368" data-df="ll" > Aug 11, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Zookeeper 学习</h3><div class="text-muted small"><p> Zookeeper 是什么 Zookeeper 是一个分布式的协调服务，可以实现 统一配置管理。比如现在有A.yml，B.yml，C.yml配置文件，里面有一些公共的配置。将这些公共配置信息放到ZK中，修改ZK的信息，会通知A，B，C配置文件。 统一命名服务。节点存储ip地址，只需要访问Znode节点就可以获取这些ip地址。 统一集群管理。Kafka 的集群管理基于Zooke...</p></div></div></a></div><div class="card"> <a href="/posts/go/"><div class="card-body"> <em class="small" data-ts="1709015108" data-df="ll" > Feb 27, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Go 语言学习</h3><div class="text-muted small"><p> 基本语法 变量初始化 1 2 3 var s string = &quot;string&quot; var s = &quot;string&quot; s := &quot;string&quot; 二维切片初始化 1 2 3 4 slice1 := make([][]bool, m) for i := range slice1 { slice1[i] = make([]bool, n) } 变量自增 只有后缀自增或自减，...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/use-branch-to-rollback/" class="btn btn-outline-primary" prompt="Older"><p>Github删除Commits记录</p></a> <a href="/posts/get-hsv-and-bgr/" class="btn btn-outline-primary" prompt="Newer"><p>Python实现点击图片获取HSV或BGR的值</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "CompetitiveLin/CompetitiveLin.github.io", "data-repo-id": "R_kgDOG9EeyQ", "data-category": "General", "data-category-id": "DIC_kwDOG9Eeyc4CN-ne", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/CompetitiveLin">CompetitiveLin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
