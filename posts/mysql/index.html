<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="MySQL知识点汇总" /><meta property="og:locale" content="en" /><meta name="description" content="单机QPS" /><meta property="og:description" content="单机QPS" /><link rel="canonical" href="/posts/mysql/" /><meta property="og:url" content="/posts/mysql/" /><meta property="og:site_name" content="Blogs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-22T13:33:24+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MySQL知识点汇总" /><meta name="twitter:site" content="@CompetitiveLin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-06T15:40:38+08:00","datePublished":"2022-06-22T13:33:24+08:00","description":"单机QPS","headline":"MySQL知识点汇总","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/mysql/"},"url":"/posts/mysql/"}</script><title>MySQL知识点汇总 | Blogs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Blogs"><meta name="application-name" content="Blogs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avator.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Blogs</a></div><div class="site-subtitle font-italic">Recording everything in here.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/CompetitiveLin" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/CompetitiveLin" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zee_lin','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>MySQL知识点汇总</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>MySQL知识点汇总</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1655876004" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 22, 2022 </em> </span> <span> Updated <em class="" data-ts="1686037238" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 6, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/CompetitiveLin">CompetitiveLin</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7773 words"> <em>43 min</em> read</span></div></div></div><div class="post-content"><h1 id="单机qps">单机QPS</h1><p>单机 QPS 为 4k 左右。</p><h1 id="mysql-select语句执行">MySQL select语句执行</h1><ul><li>prepare 阶段，检查查询语句中的表或字段是否存在，将 <code class="language-plaintext highlighter-rouge">*</code> 拓展为表上的所有列。<li>optimize 阶段，优化器决定使用哪个索引。<li>execute 阶段，执行器，索引下推。</ul><h1 id="表空间文件结构">表空间文件结构</h1><p>组成：段（默认256MB） -&gt; 区（默认1MB） -&gt; 页（默认16KB） -&gt; 行</p><p>页：InnoDB的数据按<strong>页</strong>为单位读写，默认每个页大小为16KB，意味着一次最少从磁盘读取16KB的内容到内存（Buffer Poll）中，一次最少把内存中的16KB内容刷新到磁盘中。表中的记录存储在<strong>数据页</strong>中。B+树的每个节点都是一个数据页。</p><p>区：数据量大的时候，索引分配空间则是按<strong>区</strong>为单位分配，每个区的大小为1MB，对于16KB的页来说，连续（物理连续）64个页会被划分到一个区，这样，B+树中节点所构成的链表中相邻页的物理位置也相邻，便能顺序IO。</p><p><a href="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202311051716065.png" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202311051716065.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>段：段是数据库中的分配单位，不同类型的数据库对象以不同的段形式存在。当创建数据表、索引的时候，就会相应创建对应的段，比如创建一张表时会创建一个表段，创建一个索引时会创建一个索引段。在段中不要求区与区之间是相邻的。</p><ul><li>索引段：存放B+树非叶子结点的区的集合<li>数据段：存放B+树叶子结点的区的集合<li>回滚段：存放的是回滚数据的区的集合，MVCC利用回滚段实现了多版本查询数据</ul><h2 id="区存在的意义"><span class="mr-2">区存在的意义</span><a href="#区存在的意义" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>数据页都是以双向链表的形式存在，如果以页分配存储空间，双向链表相邻的两个页之间的物理位置可能距离非常远，会产生随机 IO，影响性能</p><h2 id="段存在的意义"><span class="mr-2">段存在的意义</span><a href="#段存在的意义" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>对于范围查询，本质是对B+树叶子节点中的记录进行顺序扫描，但如果不区分叶子节点和非叶子节点，把节点代表的页都申请到区中，范围查找效率大打折扣。一个索引会产生两个段，一个叶子节点段（数据段）和一个非叶子节点段（索引段）。</p><h2 id="行格式"><span class="mr-2">行格式</span><a href="#行格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Redundant<li>Compact，一条完整的记录分为“记录的额外信息”和“记录的真实数据”，额外信息中又分为<strong>变长字段长度列表、NULL值列表和记录头数据</strong>。变长字段长度列表和NULL值列表都是倒序保存，并且不是必须的，只要没有变长字段或NULL值字段即可。8个字段值可以为NULL，那么NULL值列表空间为1字节，9字段则2字节。<li>Dynamic<li>Compressed</ul><h2 id="varcharn-n最大取多少"><span class="mr-2">Varchar(n) n最大取多少？</span><a href="#varcharn-n最大取多少" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>MySQL 规定除了 TEXT、BLOBs 这种大对象类型之外，其他所有的列（不包括隐藏列和记录头信息）占用的字节长度加起来不能超过 65535 个字节。注意，是一行数据的最大字节数 65535，其实是包含「变长字段长度列表」和 「NULL 值列表」所占用的字节数的。</p><p>行格式溢出后，数据存放到<strong>溢出页</strong>。</p><h2 id="text-各个类型对比"><span class="mr-2">text 各个类型对比</span><a href="#text-各个类型对比" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>TINYTEXT 最大长度是 255 (2^8 – 1) 个字符。<li>TEXT 最大长度是 65535 (2^16 – 1) 个字符。<li>MEDIUMTEXT 最大长度是 16777215 (2^24 – 1) 个字符。<li>LONGTEXT 最大长度是 4294967295 (2^32 – 1) 个字符<li>Varchar 对每个英文(ASCII)字符都占用2个字节，对一个汉字也只占用两个字节<li>Char 对英文(ASCII)字符占用1个字节，对一个汉字占用2个字节</ul><p>数据的检索效率是：char&gt;varchar&gt;text</p><p>char: 定长，会用空格补齐 varchar：变长</p><h1 id="b树和b树">B树和B+树</h1><ul><li>B树（多路的平衡搜索树），节点可以存储多个数据，并且每个节点存放索引和数据，一个节点的<strong>关键字</strong>等于该节点子节点个数减一。查询的最好情况是O（1），一般高度为3。<li>B+树，非叶子节点关键字个数等于子节点个数<ol><li>叶子节点保存数据（数据页），非叶子节点保存索引，查询固定为O（logn），并且由于这个特点更适合外部存储。<li>叶子节点有指向下一个叶子节点的指针，双向链表，可顺序访问，因此区间访问的性能较好。<li>存在重复元素，因为非叶子结点不保存数据。</ol></ul><p>与红黑树的比较，B+树的优势：</p><ol><li>更少的查询次数，因为B+树的树高一般小<li>利用计算机的预读特性，因为B+树具有类似链表的特点，因此相邻的节点也能被预先载入</ol><p>为什么不使用 B 树：B+ 树的非叶子节点只存储索引，单个节点可以存储更多的索引，计算机一次性加载更多的索引数据到内存中。并且B树不适合范围查找。</p><p>为什么不使用跳表：MySQL 一次数据页加载都需要一次磁盘IO。并且磁盘IO的次数和树高有关系，又因为跳表的高度一般比B+树高，所以查询速度会大大降低，因此不适合。</p><p>为什么 Redis 使用了跳表：因为 Redis 不存在磁盘IO。重点在于磁盘IO次数。</p><h2 id="mysql索引"><span class="mr-2">MySQL索引</span><a href="#mysql索引" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>给表添加索引时，是会对表加锁，因此在生产环境中不能直接添加索引。InnoDB 存储引擎默认会创建一个主键索引，也就是聚簇索引，其它索引都属于二级索引。当没有显式定义主键索引时，MySQL 会选择第一个唯一索引，并自动设置非空约束，当作聚簇索引。</p><h3 id="数据结构维度"><span class="mr-2">数据结构维度：</span><a href="#数据结构维度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>B+树索引，适合范围查询，复杂度为O（logn）。<li>哈希索引，能以O（1）时间进行查找，但失去有序性，无法用于排序和分组，只支持精确查找（等值查找）。<li>全文索引，使用倒排索引实现，记录关键词到所在文档的映射，一般在text, varchar上创建。<li>R-Trees索引，MyISAM支持的索引类型，和空间地理数据有关。</ol><h3 id="物理存储维度innodb"><span class="mr-2">物理存储维度（InnoDB）：</span><a href="#物理存储维度innodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>聚簇索引，叶节点存放一整行记录。一个表只能拥有一个聚簇索引。并非完全等价于主键索引。<li>非聚簇索引（二级索引），叶节点只存放主键信息，所以一般需要回表查询。</ol><h3 id="逻辑维度"><span class="mr-2">逻辑维度</span><a href="#逻辑维度" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>主键索引，不允许空值<li>普通索引，没任何限制<li>联合索引，多个字段创建的索引，使用时遵循左前缀原则。<li>唯一索引，索引列中的值必须是唯一的，但可以为空值。<li>空间索引</ol><h3 id="索引失效触发全盘扫描主要看是否回表或者是查询的数据量过大"><span class="mr-2"><a href="https://www.51cto.com/article/702691.html">索引失效（触发全盘扫描）</a>主要看是否回表或者是查询的数据量过大</span><a href="#索引失效触发全盘扫描主要看是否回表或者是查询的数据量过大" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>一定失效：</p><ol><li>索引列参与运算<li>索引列使用函数<li>两列做比较<li>类型隐式转换</ol><p>可能失效：</p><ol><li>不满足最左匹配（覆盖索引，索引下推，索引跳跃扫描）<li>尽可能明确查询列，而不是select *，即使不满足最左匹配（可以用于性能优化）<li>like关键字的左模糊和左右模糊(如果覆盖索引便不失效)<li>错误的or使用（切记两个条件都要添加索引，否则会导致索引失效，or两边同时使用 &lt; 和 &gt;，也会失效）<li>错误的 &lt;&gt; 和 != 使用（查询结果集占比较大时索引会失效）<li>is not null(is null 走索引)<li>not in(条件列是主键时走索引)<li>not exists<li>orderby（部分会失效）<li>范围过大的 between and</ol><h3 id="索引跳跃扫描"><span class="mr-2">索引跳跃扫描</span><a href="#索引跳跃扫描" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>最左缀原则可以通过跳跃扫描的方式打破，当第一列索引的唯一值较少时，即使where条件没有第一列索引，查询的时候也可以用到联合索引。</p><h3 id="覆盖索引"><span class="mr-2">覆盖索引</span><a href="#覆盖索引" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>指查询列被所建的索引覆盖，覆盖索引是 <code class="language-plaintext highlighter-rouge">select</code> 的数据列只需要从索引中就能取到，不必回表。例如对于联合索引(col1,col2,col3)，查询语句SELECT col1,col2,col3 FROM test WHERE col2=2</p><h3 id="哪些情况下不适合建索引"><span class="mr-2">哪些情况下不适合建索引</span><a href="#哪些情况下不适合建索引" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>数据量少<li>更新频繁<li>区分度低<li>where, groupby, orderby 后没有使用到的字段<li>联合索引中的索引</ul><h3 id="索引下推"><span class="mr-2">索引下推</span><a href="#索引下推" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>指将部分上层（服务层）负责index filter的事情，交给了下层（引擎层）去处理。它能减少<strong>二级索引</strong>再查询时的回表查询次数，提高查询效率。只适用于二级索引。</p><p>EXPLAIN 命令的extra一栏中有Using index condition，表明使用了索引下推</p><p>举例：<code class="language-plaintext highlighter-rouge">select * from table1 where b like '3%' and c = 3</code></p><p>5.6 之前：</p><ul><li>先通过 联合索引 查询到 开头为 3 的数据 然后拿到主键<li>然后通过主键去主键索引里面去回表查询 二级索引里面查询出来几个 3 开头的就回表几次</ul><p>5.6 之后：</p><ul><li>先通过 二级索引 查询到开头为 3 的数据 然后 再找到 c = 3 的数据进行过滤 之后拿到主键<li>通过主键进行回表查询，减少了回表次数</ul><h3 id="建索引的原则"><span class="mr-2">建索引的原则</span><a href="#建索引的原则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>选择唯一性索引<li>为经常需要orderby，groupby操作的字段建立索引<li>经常作为查询条件的字段建立索引<li>限制索引数量<li>尽量使用数据量少的索引<li>尽量使用最左前缀匹配原则<li>使用区分度高的列作为索引<li>扩展索引而不是新建索引</ol><h3 id="强制索引"><span class="mr-2">强制索引</span><a href="#强制索引" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="深度分页"><span class="mr-2">深度分页</span><a href="#深度分页" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>有分页需求时，一般会用limit实现，但是当偏移量特别大的时候，查询效率就变得低下。</p><p><code class="language-plaintext highlighter-rouge">select * from table limit 10</code> 和 <code class="language-plaintext highlighter-rouge">select * from table limit 10000, 10</code> 的查询时间是不一样的，后者是查询出 10010 条，再取最后 10 条记录。</p><p>本质原因就是：每次查询时扫描整张表（不走索引），偏移量（offset）越大，mysql就会扫描越多的行，然后再抛弃掉。这样就导致查询性能的下降。</p><p>解决方案：</p><ol><li>标签记录法，记录上一页最后一条记录的ID或时间戳，作为下一页的查询条件，使用 <code class="language-plaintext highlighter-rouge">select * from table where id &gt; 10000 limit 10</code>，<li>范围查询，使用 <code class="language-plaintext highlighter-rouge">select * from table where id between 100000 and 100010 order by id desc;</code><li>延迟关联（子查询优化），先通过索引获取主键ID，再关联原表获取完整数据，把条件转移到主键索引树，使用 <code class="language-plaintext highlighter-rouge">select * from table where id &gt;= (select a.id from table a where a.update_time &gt;= xxx limit 100000, 1) limit 10</code><li>尽量满足索引覆盖</ol><h2 id="单表数据量大了性能为什么下降"><span class="mr-2">单表数据量大了性能为什么下降</span><a href="#单表数据量大了性能为什么下降" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>因为表的数量达到一定量级后，MySQL 内存无法存储所有的索引，使得查询语句需要产生磁盘IO，导致性能下降。</p><h2 id="acid-原则"><span class="mr-2">ACID 原则</span><a href="#acid-原则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Atomicity（原子性），每次事务是原子的，事务包含的所有操作要么全部成功，要么全部不执行。一旦有操作失败，则需要回退状态到执行事务之前；通过 undo log 来保证。<li>Consistency（一致性），数据库的状态在事务执行前后的状态是一致的和完整的，无中间状态。即只能处于成功事务提交后的状态；例如转账前后，两用户的余额总和一定是不变的。通过原子性 + 隔离性 + 持久性保证的。<li>Isolation（隔离性），各种事务可以并发执行，但彼此之间互相不影响。按照标准 SQL 规范，从弱到强可以分为读未提交、读已提交、可重复读和串行化四种隔离等级；通过 MVCC 或锁机制保证的。<li>Durability（持久性），状态的改变是持久的，不会失效。一旦某个事务提交，则它造成的状态变更就是永久性的，即便系统故障也不会丢失。通过 redo log 来保证。</ul><h2 id="事务的隔离"><span class="mr-2">事务的隔离</span><a href="#事务的隔离" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>MVCC 用于解决脏读和不可重复读的问题，在读已提交和可重复读两种隔离级别生效。读已提交是每次 select 都会重新生成一次 Read View，而可重复读是一次事务只会创建一次且在第一次查询时创建 Read View。</p><p>MVCC: Read view + undo log + 两个隐藏字段，基于乐观锁的理论为了解决读写冲突，可以在读已提交和可重复读的隔离级别下使用。</p><ul><li>Read View 是一个事务快照，保存当前事务开启时所有活跃的事务列表。通过与版本链的配合可以实现对数据的 “快照读”。其中也有四个字段，分别是creater_trx_id, m_ids, min_trx_id, max_trx_id。<li>undo log 是存放更新前的数据（快照），保存了历史快照<li>隐藏字段：row_trx_id 和 roll_pointer，前者表示更新行数据的事务id，后者是上一次修改之前保存在 undo log 中的记录位置（指针），使<strong>每行记录变化前后形成了一条版本链</strong></ul><p>MVCC(Multiversion Concurrency Control) + 间隙锁在RR的隔离级别下能解决大部分幻读情况</p><ul><li>仅快照读的情况下（普通 select 语句），通过 MVCC 的方式，在执行第一个查询语句后，会创建一个 Read View，后续的查询语句利用这个 Read View，通过这个 Read View 就可以在 undo log 版本链找到事务开始时的数据，多次查询获取的是同一个快照数据。<li>仅当前读的情况下（select … for update 等语句），通过 Next-Lock Key（临键锁），其他事务的插入操作会被阻塞。<ul><li>查询条件不走索引，退化成<strong>表锁</strong>。<li>查询条件走普通索引，锁住查询条件附近的间隙，等于<strong>间隙锁</strong><li>查询条件走唯一索引，只锁一条数据，等价于<strong>记录锁</strong></ul><li>解决不了的幻读情况：快照读和当前读发生在同一个事务中（更新、删除等操作本质也需要进行当前读）<ol><li>事务A快照读，事务B新增数据并提交，接着事务A修改事务B新增的数据并快照读，此时发生幻读。<li>事务A快照读，事务B新增数据并提交，接着事务A当前读，此时发生幻读。</ol></ul><p>若要尽可能避免幻读现象的发生，尽量在开启时候后马上执行当前读。</p><p>三种问题：</p><ol><li>脏读，指读取未提交数据，事务的数据可能回滚，导致数据不一致。<li>不可重复读，指在同一事务内读到的数据是不一致的<li>幻读，指同一事务在查询的过程中，有另外一个事务对范围内<strong>新增了记录</strong>，导致范围查询的结果条数不一致的现象。</ol><p>SQL的四种隔离级别：</p><ol><li>读未提交，指一个事务还没提交时，它做的变更就能被其他事务看到。可能出现脏读<li>读已提交，指一个事务提交之后，它做的变更才能被其他事务看到。可能出现不可重复读<li>可重复读，指一个事务执行过程中看到的数据，一直跟这个事务启动时看到的数据是一致的。可能出现幻读，但<strong>使用MVCC + 间隙锁能解决大部分幻读现象</strong>，事务开始读操作的时候，不允许其他事务对读的数据做修改<li>串行化，对记录加上读写锁，在多个事务对这条记录进行读写操作时，如果发生了读写冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行；</ol><h2 id="wal-机制"><span class="mr-2">WAL 机制</span><a href="#wal-机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>MySQL 保证数据不丢失： 两阶段提交 + WAL(Write-ahead logging)</p><p>WAL 核心：指 MySQL 在执行写操作时先记录在日志中，后更新到磁盘中。将随机写（磁盘的写操作是随机IO，耗性能）转变成顺序写和组提交机制，降低客户端延迟，提高吞吐量。</p><h3 id="三大日志binlog-redolog-undolog"><span class="mr-2">三大日志binlog, redolog, undolog:</span><a href="#三大日志binlog-redolog-undolog" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>Buffer Pool是MySQL进程管理的一块内存空间，有减少磁盘IO次数的作用。<li>redo log重做日志是InnoDB存储引擎的一种物理格式的日志，用来实现事务<strong>持久性</strong>，主要有两部分文件组成，在内存中的重做日志缓冲（redo log buffer）以及磁盘中的重做日志文件（redo log），（循环写，数据会被覆盖）。使用场景：<strong>崩溃恢复</strong>，在发生故障的时间点，尚有脏页未写入磁盘，在重启 mysql 服务的时候，根据 redo log 进行重做，从而达到事务的持久性这一特性。<li>undo log回滚日志是InnoDB存储引擎的一种逻辑格式的日志，记录的是数据的逻辑变化，保证的是数据库的<strong>原子性</strong>，比如一条insert语句对应的是一条delete的undo log，在发生事务错误时，就能回滚到事务之前的数据状态；<strong>MVCC</strong>，事务未提交前，undo log 保存了未提交的版本数据，作为旧版本的快照数据，类似于做备份。<li>binlog是MySQL Server层的一种逻辑格式的日志，用于记录数据库执行的写入性操作(不包括查询)信息，以二进制的形式保存在磁盘中。使用场景：<strong>主从复制</strong> ：采用异步复制方式，在 Master 端开启 binlog ，然后将 binlog 发送到各个 Slave 端， Slave 端重放 binlog 从而达到主从数据一致；<strong>数据恢复</strong>，通过使用 mysqlbinlog 工具再结合 binlog 文件，可以将数据恢复到过去的某一时刻。</ol><h4 id="主从复制"><span class="mr-2">主从复制</span><a href="#主从复制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>如果对数据一致性和可靠性要求较高，可以考虑使用半同步复制；如果对延迟和主服务器性能要求较高，可以继续使用异步复制，根据实际需求调整复制模式。</p><h5 id="异步复制"><span class="mr-2">异步复制</span><a href="#异步复制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ol><li>master服务器将数据的改变记录二进制binlog日志，当master上的数据发生改变时，则将其改变写入二进制日志中；<li>slave服务器会在一定时间间隔内对master二进制日志进行探测其是否发生改变，如果发生改变，则开始一个I/OThread请求master二进制事件<li>主节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至从节点本地的中继日志中，<li>从节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，使得其数据和主节点的保持一致，最后I/OThread和SQLThread将进入睡眠状态，等待下一次被唤醒。</ol><h5 id="半同步复制"><span class="mr-2">半同步复制</span><a href="#半同步复制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><p>主服务器将数据修改操作记录到二进制日志，并等待至少一个slave服务器确认已接收到并应用了这些日志后才继续执行后续操作。</p><h4 id="binlog"><span class="mr-2">Binlog</span><a href="#binlog" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Binlog 有三种格式：</p><ol><li>Row，记录操作语句对具体行的操作和操作前的整行信息。缺点是占用空间大，优点是保证数据安全<li>Statement，记录修改的 sql 语句。缺点是在mysql集群时的一些操作会导致数据不一致（例如 Now() 的时间不同）。<li>Mixed</ol><p>写入到磁盘的操作：</p><ol><li>write：从 Buffer pool 写到 page cache。<li>fsync：将数据持久化到磁盘。</ol><p>Binlog 的持久化：</p><ol><li>sync_binlog=0 的时候，表示每次提交事务都只 write，不 fsync；<li>sync_binlog=1 的时候，表示每次提交事务都会执行 fsync；<li>sync_binlog=N(N&gt;1) 的时候，表示每次提交事务都 write，但累积 N 个事务后才 fsync。</ol><h4 id="redolog"><span class="mr-2">Redolog</span><a href="#redolog" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>写入流程：</p><ol><li>写入 redo log buffer<li>写入（write）到 page cache<li>持久化（fsync）到磁盘中</ol><p>刷盘时机：</p><ol><li>MySQL 正常关闭<li>redo log buffer 的写入量大于 redo log buffer 内存空间（默认8MB）的一半时，write 到 page cache 中。<li>后台线程每隔一秒调用 write 将 redo log buffer 写到 page cache，然后 fsync 持久化到磁盘。<li>innodb_flush_log_at_trx_commit 参数<li>当innodb_flush_log_at_trx_commit=0时，InnoDB会<strong>每秒钟</strong>将log buffer的数据<strong>write</strong>到文件系统缓存中，并调用<strong>fsync</strong>操作将数据缓存更新至磁盘中，与事务的执行与否无关。因此，在实例崩溃恢复场景中，可能会出现丢失1秒钟的事务。<li>当innodb_flush_log_at_trx_commit=1时，InnoDB将在<strong>每次事务提交</strong>时将log buffer的数据<strong>write</strong>到文件系统缓存中，并调用<strong>fsync</strong>操作将数据缓存更新至磁盘中。此种方式下，数据库完全遵守ACID特性，安全性较高。<li>当innodb_flush_log_at_trx_commit=2时，InnoDB将在<strong>每次事务提交</strong>时将log buffer中的数据<strong>write</strong>到文件系统缓存中，<strong>每秒钟</strong>将文件系统缓存中的数据<strong>fsync</strong>到磁盘中。不能完全保证每秒更新磁盘一次，没有被更新到磁盘中的事务可能会因宕机而丢失。</ol><h4 id="buffer-pool"><span class="mr-2">Buffer Pool</span><a href="#buffer-pool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p><a href="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202409261455571.png" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202409261455571.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>在 MySQL 启动时，向操作系统申请一片连续的空间，大小为 <code class="language-plaintext highlighter-rouge">128MB</code>。Buffer Pool中维护的数据结构是缓存页（16 KB 的数据页），而且每个缓存页都有它对应的描述信息。还有存在三个双向链表，分别是FreeList、LRUList以及FlushList。这三个双向链表中维护着缓存页的描述信息。</p><p>读写数据流程：当读取数据时，先读 Buffer Pool 中的数据，再去磁盘中读；写数据时，修改 Buffer Pool 中的页，设置为脏页，最后由后台线程写入到磁盘；</p><h5 id="双向链表"><span class="mr-2">双向链表</span><a href="#双向链表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5><ol><li>FreeList，存放空闲的缓存页的描述信息<li>LRUList，用于提高缓存命中率<li>FlushList，存放脏页的描述信息</ol><p>为了解决预读失效（被提前加载进来的数据页并没有被访问）的问题，链表做了冷热数据分离优化，5/8的区域是热数据区域，3/8的区域算是冷数据区域</p><p>为了解决 Buffer Pool 污染（扫描大量数据把热数据淘汰掉）的问题，进入热数据区域设置一个时间判断，如果数据被访问并且在冷数据区域的停留时间超过 1 秒，才会被放入热数据区域，否则仍然被放入冷数据区域。</p><h4 id="脏页刷新"><span class="mr-2">脏页刷新</span><a href="#脏页刷新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>当 redo log 日志满了的情况下，会主动触发脏页刷新到磁盘；<li>Buffer Pool 空间不足时，需要将一部分数据页淘汰掉，如果淘汰的是脏页，需要先将脏页同步到磁盘；<li>MySQL 认为空闲时，后台线程会定期将适量的脏页刷入到磁盘；<li>MySQL 正常关闭之前，会把所有的脏页刷入到磁盘；</ol><h3 id="crash-safe-能力两阶段提交崩溃恢复"><span class="mr-2">Crash-Safe 能力，两阶段提交（崩溃恢复）</span><a href="#crash-safe-能力两阶段提交崩溃恢复" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>前提：innodb_flush_log_at_trx_commit 设置为1，sync_binlog 设置大于0</p><ol><li>先将数据修改<strong>写入redo log</strong>，并将其标记为 prepare 状态<li>将相应的 sql 语句<strong>写入 binlog</strong><li>commit阶段：将 <strong>redo log 标记为 commit 状态</strong>，然后根据 sync_binlog 参数的设置，决定是否将 binlog 刷盘</ol><p>如果发生崩溃，先检查 redo log 记录的事务操作是否为 commit 状态。</p><ol><li>如果是 commit 状态说明没有数据丢失，判断下一个。<li>如果是 prepare 状态，检查 binlog 记录的对应事务操作（redo log 与 binlog 记录的事务操作有一个共同字段 XID，redo log 就是通过这个字段找到 binlog 中对应的事务的）是否完整（这点在前面 binlog 三种格式分析过，每种格式记录的事务结尾都有特定的标识），如果完整就将 redo log 设为 commit 状态，然后结束；不完整就回滚 redo log 的事务，结束。</ol><h2 id="执行顺序"><span class="mr-2">执行顺序</span><a href="#执行顺序" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>from<li>on<li>join<li>where<li>group by<li>having<li>select<li>distinct<li>order by<li>limit</ol><p>每一步执行时都会产生一个虚拟表，都会被用作下一个步骤的输入。</p><h1 id="锁">锁</h1><h2 id="乐观锁悲观锁"><span class="mr-2">乐观锁、悲观锁</span><a href="#乐观锁悲观锁" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>乐观锁：不能解决脏读问题<li>悲观锁：select … for update</ul><h2 id="全局锁表级锁行锁"><span class="mr-2">全局锁、表级锁、行锁</span><a href="#全局锁表级锁行锁" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>全局锁：对整个数据库实例加锁，处于只读状态，其命令是Flush tables with read lock（FTWRL），用于全库逻辑备份。<li>表级锁：开销小，加锁快，不会出现死锁，发生锁冲突的概率最高，并发度最低。适合以查询为主。<ul><li>表锁，可以添加表级别的共享锁或排他锁，锁的粒度较粗。<li>元数据锁（MDL），CRUD时，数据库自动给表加上MDL读锁；变更表结构时，自动加MDL写锁。事务提交后才会释放MDL锁。<li>意向锁，在执行插入、更新、删除需要加独占锁之前，需要对表先加上意向独占锁，其目的是快速判断表里是否<strong>有记录被加锁</strong>。<li>AUTO-INC锁，自增锁，插入数据时获取该锁，插入语句完成后，释放锁。</ul><li>行锁：开销大，加锁慢，会出现死锁，发生锁冲突的概率最低，并发读也高。只有InnoDB引擎支持。行锁依赖于索引，如果加锁操作没有使用到索引，那么会退化成表锁。<ul><li>记录锁：锁定一条记录，存在 S 型记录锁和 X 型记录锁。加了 S 型记录锁后可以继续加 S 型记录锁，但不能加 X 型记录锁；加了 X 型记录锁后不能加 S 型或 X 型记录锁。存在于包含主键索引的唯一索引中。<li>间隙锁：锁定一个范围，前开后开，不包含记录本身，存在于可重复读和串行化这两种隔离级别，为了解决可重复读隔离级别下幻读的现象。插入意向锁是一种表明插入意向的间隙锁。<li>临键锁（next-key lock）：加锁的基本单位，锁定一个范围，前开后闭，存在于非唯一索引中。</ul></ul><h2 id="共享锁读锁排他锁写锁"><span class="mr-2">共享锁（读锁）、排他锁（写锁）</span><a href="#共享锁读锁排他锁写锁" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>共享锁：读锁，其他事务可以读，但不能写，<code class="language-plaintext highlighter-rouge">select lock in share mode</code><li>排他锁：写锁，其他事务不能读，也不能写，<code class="language-plaintext highlighter-rouge">select for update</code></ul><h1 id="for-update-加什么锁">For update 加什么锁</h1><h2 id="rc-隔离级别"><span class="mr-2">RC 隔离级别</span><a href="#rc-隔离级别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>唯一索引 + 有值：记录锁<li>主键 + 有值：记录锁<li>普通索引 + 有值：记录锁<li>无索引 + 有值：记录锁</ol><h2 id="rr-隔离级别"><span class="mr-2">RR 隔离级别</span><a href="#rr-隔离级别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>主键查询 + 有值：记录锁<li>主键查询 + 空值：间隙锁<li>唯一索引 + 有值：记录锁<li>唯一索引 + 空值：间隙锁<li>普通索引 + 有值：间隙锁<li>普通索引 + 空值：间隙锁<li>索引 + 范围查询：间隙锁</ol><p>只要通过查询条件查到的数据不唯一，就加间隙锁。</p><h2 id="mysql-数据实时同步到es"><span class="mr-2">mysql 数据实时同步到Es</span><a href="#mysql-数据实时同步到es" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>常见的数据同步方案主要有以下三种：</p><ol><li>同步调用。在实现增删改的同时，通过调用ES所在服务提供的接口。<li>异步调用。增删改服务和搜索服务分别通过MQ进行发送和监听消息，有效降低业务的耦合度，但较为依赖MQ的性能。<li>binlog监听。给MySQL开启binlog功能，搜索服务基于canal监听binlog变化，但开启binlog会增加数据库负担、同时实现复杂度较高。<li>Canal<li>Flink CDC</ol><p>但也有异步调用和binlog监听结合在一起的<a href="https://github.com/Scoefield/syncMySqlToES">例子</a>，用canal作slave节点。</p><h2 id="分库分表"><span class="mr-2">分库/分表</span><a href="#分库分表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>分为 <strong>水平切分（又称为 Sharding）</strong> 和 <strong>垂直切分</strong>。</p><h3 id="切分策略"><span class="mr-2">切分策略</span><a href="#切分策略" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>范围切分，例如每一千万条数据一张表<li>哈希切分，对分表键进行哈希运算，主流方法<li>映射表，将分表键和数据库表对映射关系记录在表上</ul><h3 id="分布式id"><span class="mr-2">分布式ID</span><a href="#分布式id" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://pic4.zhimg.com/80/v2-0ca4a4125b1cbda69cfa972b1e568ffb_1440w.webp" class="popup img-link "><img data-src="https://pic4.zhimg.com/80/v2-0ca4a4125b1cbda69cfa972b1e568ffb_1440w.webp" alt="" class="lazyload" data-proofer-ignore></a></p><p>建议使用雪花算法，其中<strong>序列号一直保持递增，不会因为时间戳的不同而归零</strong>，防止被猜测上下文ID。</p><h2 id="注入攻击"><span class="mr-2">注入攻击</span><a href="#注入攻击" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>通过客户端向应用程序输入数据来插入或注入一个 SQL 查询/操作。</p><h3 id="防止注入攻击"><span class="mr-2">防止注入攻击</span><a href="#防止注入攻击" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>参数化查询<li>使用正则化验证输入<li>最小权限原则<li>字符串过滤关键字</ol><h3 id="mybatis--和--的区别"><span class="mr-2">MyBatis <code class="language-plaintext highlighter-rouge">#</code> 和 <code class="language-plaintext highlighter-rouge">$</code> 的区别</span><a href="#mybatis--和--的区别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><code class="language-plaintext highlighter-rouge">#</code> 将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。很大程度防止sql注入<li><code class="language-plaintext highlighter-rouge">$</code> 将传入的数据直接显示生成在sql中。无法防止Sql注入。</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/backend/'>Backend</a>, <a href='/categories/mysql/'>MySQL</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB%20-%20Blogs&url=%2Fposts%2Fmysql%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB%20-%20Blogs&u=%2Fposts%2Fmysql%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fmysql%2F&text=MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB%20-%20Blogs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/elasticsearch/">ElasticSearch</a><li><a href="/posts/note-from-work/">Note from Work</a><li><a href="/posts/redis/">Redis 知识体系</a><li><a href="/posts/springboot/">SpringBoot</a><li><a href="/posts/go/">Go 语言学习</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/redis/"><div class="card-body"> <em class="small" data-ts="1688642680" data-df="ll" > Jul 6, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Redis 知识体系</h3><div class="text-muted small"><p> 单机 QPS 单机 QPS 能力参考范围为 8 - 10 万。 为什么 Redis 这么快 用 C 语言编写的，执行效率高 基于内存的数据库，避免磁盘IO操作 采用高效的数据结构 合理的数据编码，同样的数据结构在不同数据量的情况下采用不同的编码方式 采用单线程，避免上下文切换 多路IO复用，一个线程处理多个大量Socket请求。 虚拟内存 虚拟内存 R...</p></div></div></a></div><div class="card"> <a href="/posts/java-syntax/"><div class="card-body"> <em class="small" data-ts="1655046844" data-df="ll" > Jun 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java知识点记录博客</h3><div class="text-muted small"><p> 运算符优先级 优先级 运算符 1 ( )　[ ] 　. 2 ! 　~　 ++　 – 3 *　 /　 % 4 +　 - 5 ...</p></div></div></a></div><div class="card"> <a href="/posts/java/"><div class="card-body"> <em class="small" data-ts="1655792594" data-df="ll" > Jun 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basics of Java</h3><div class="text-muted small"><p> 基本知识 三大特点：封装继承多态。 语法糖：switch支持String、泛型、自动拆装箱、变长参数、枚举、内部类、条件编译、断言、数值下划线、for-each、try-with-resources、Lambda表达式 装箱：Integer i = Integer.valueOf(10)， 拆箱：int n = i.intValue() 反射：指动态获取的信息以及动态调用对象的方法的...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/java/" class="btn btn-outline-primary" prompt="Older"><p>Basics of Java</p></a> <a href="/posts/segment-tree/" class="btn btn-outline-primary" prompt="Newer"><p>线段树（Java实现）</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "CompetitiveLin/CompetitiveLin.github.io", "data-repo-id": "R_kgDOG9EeyQ", "data-category": "General", "data-category-id": "DIC_kwDOG9Eeyc4CN-ne", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/CompetitiveLin">CompetitiveLin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
