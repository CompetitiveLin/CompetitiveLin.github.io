<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="SpringBoot" /><meta property="og:locale" content="en" /><meta name="description" content="Spring, SpringBoot, Spring MVC 区别： Spring框架(Framework)是最流行的Java应用程序开发框架。 Spring框架的主要功能是依赖项注入或控制反转(IoC)。 Spring MVC是Spring的一个MVC框架，包含前端视图，文件配置等。XML和config配置比较复杂。 Spring Boot 是为简化Spring配置的快速开发整合包，允许构建具有最少配置或零配置的独立应用程序。" /><meta property="og:description" content="Spring, SpringBoot, Spring MVC 区别： Spring框架(Framework)是最流行的Java应用程序开发框架。 Spring框架的主要功能是依赖项注入或控制反转(IoC)。 Spring MVC是Spring的一个MVC框架，包含前端视图，文件配置等。XML和config配置比较复杂。 Spring Boot 是为简化Spring配置的快速开发整合包，允许构建具有最少配置或零配置的独立应用程序。" /><link rel="canonical" href="/posts/springboot/" /><meta property="og:url" content="/posts/springboot/" /><meta property="og:site_name" content="Blogs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-10T15:08:32+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SpringBoot" /><meta name="twitter:site" content="@CompetitiveLin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-04T18:22:37+08:00","datePublished":"2023-08-10T15:08:32+08:00","description":"Spring, SpringBoot, Spring MVC 区别： Spring框架(Framework)是最流行的Java应用程序开发框架。 Spring框架的主要功能是依赖项注入或控制反转(IoC)。 Spring MVC是Spring的一个MVC框架，包含前端视图，文件配置等。XML和config配置比较复杂。 Spring Boot 是为简化Spring配置的快速开发整合包，允许构建具有最少配置或零配置的独立应用程序。","headline":"SpringBoot","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/springboot/"},"url":"/posts/springboot/"}</script><title>SpringBoot | Blogs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Blogs"><meta name="application-name" content="Blogs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avator.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Blogs</a></div><div class="site-subtitle font-italic">Recording everything in here.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/CompetitiveLin" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/CompetitiveLin" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zee_lin','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SpringBoot</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>SpringBoot</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1691651312" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 10, 2023 </em> </span> <span> Updated <em class="" data-ts="1733307757" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 4, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/CompetitiveLin">CompetitiveLin</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3040 words"> <em>16 min</em> read</span></div></div></div><div class="post-content"><p>Spring, SpringBoot, Spring MVC 区别：</p><ul><li>Spring框架(Framework)是最流行的Java应用程序开发框架。 Spring框架的主要功能是依赖项注入或控制反转(IoC)。<li>Spring MVC是Spring的一个MVC框架，包含前端视图，文件配置等。XML和config配置比较复杂。<li>Spring Boot 是为简化Spring配置的快速开发整合包，允许构建具有最少配置或零配置的独立应用程序。</ul><h2 id="springboot项目启动流程"><span class="mr-2">SpringBoot项目启动流程：</span><a href="#springboot项目启动流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>总体来说分两部分，先初始化 SpringApplication，再运行 SpringApplication。</ul><p>运行 SpringApplication 又分为： 1、获取并启动监听器 2、根据监听器和参数来创建运行环境 3、准备 Banner 打印器 4、创建 Spring 容器 5、Spring 容器前置处理（将前几步生成的监听器，Banner打印器和环境等配置到容器中） 6、刷新容器 7、Spring 容器后置处理（空方法） 8、发出结束执行的事件通知 9、返回容器</p><p>Spring核心之控制反转（IOC）和依赖注入（DI）：</p><ul><li><strong>IOC是一种设计思想</strong>，将设计好的Bean对象交给容器控制，而不是在传统的在对象内部直接控制。用@Configutation + @Bean的方式。用通俗的话解释就是在容器里创建Bean对象，在需要的时候取出使用即可。<li><strong>DI是一种实现方式</strong>，将应用程序依赖的对象注入到容器中。</ul><h3 id="ioc"><span class="mr-2">IoC</span><a href="#ioc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>refresh() 的作用：在创建IoC容器前，如果已经有容器存在，则需要把已有的容器销毁和关闭，以保证在refresh之后使用的是新建立起来的IoC容器。refresh的作用类似于对IoC容器的重启，在新建立好的容器中对容器进行初始化，对Bean定义资源进行载入。</p><p><a href="https://www.cnblogs.com/three-fighter/p/16007800.html">Spring创建Bean的三步（由反射创建的）</a>：</p><ul><li>实例化，<code class="language-plaintext highlighter-rouge">AbstractAutowireCapableBeanFactory</code> 的 <code class="language-plaintext highlighter-rouge">createBeanInstance</code> 方法<li>属性注入，<code class="language-plaintext highlighter-rouge">AbstractAutowireCapableBeanFactory</code> 的 <code class="language-plaintext highlighter-rouge">populateBean</code> 方法<li>初始化，<code class="language-plaintext highlighter-rouge">AbstractAutowireCapableBeanFactory</code> 的 <code class="language-plaintext highlighter-rouge">initializeBean</code> 方法<ul><li>调用Aware接口（如果实现了Aware接口）<li>postProcessBeforeInitialization<li>afterPropertiesSet<li>init-method<li>postProcessAfterInitialization</ul></ul><p>Spring启动时先扫描所有Bean信息，BeanDefinition存储日常给Spring Bean定义的元数据。然后存储BeanDefinition的BeanDefinitionMap，是根据字典序依次创建Bean对象。</p><h2 id="两种ioc容器"><span class="mr-2">两种IOC容器</span><a href="#两种ioc容器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>IOC的实现原理是工厂模式加反射机制。</p><ul><li>BeanFactory，只提供了实例化对象和获取对象的功能，使用懒加载机制，不支持国际化和基于依赖的注解<li>ApplicationContext，其拓展了BeanFactory接口，使用即时加载的机制，它是在Ioc启动时就一次性创建所有的Bean，支持国际化和基于依赖的注解，包括AnnotationConfigApplicationContext、ClassPathXmlApplicationContext、FileSystemXmlApplicationContext等</ul><p><a href="https://developer.aliyun.com/article/766880">三级缓存解决循环依赖</a>：</p><ul><li>前提，出现循环依赖的Bean必须是单例；依赖注入的方式不能全是构造器注入（通过setter方法进行依赖注入，全是构造器注入则无法解决循环依赖）。<li>getSingleton(beanName)方法三级缓存<ol><li>singletonObjects，一级缓存，存储的是所有创建好了的<strong>单例Bean对象</strong><li>earlySingletonObjects，二级缓存，完成实例化，但是还未进行属性注入及初始化的<strong>提前暴露的对象</strong><li>singletonFactories，三级缓存，存放<strong>生产对象的工厂</strong>，并且每次从这个工厂中拿到的对象都是不一样的，二级缓存中存储的就是从这个工厂中获取到的对象，如果Bean存在AOP的话，返回的是AOP的<strong>代理对象</strong>，提前进行了代理，避免对后面重复创建代理对象。对象加入三级缓存的前提是执行了构造器，因此全是构造器注入的循环依赖无法解决。</ol></ul><p><a href="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202305231628567.png" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202305231628567.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>为什么需要二级缓存： 如果出现循环依赖+aop时，多个地方注入这个动态代理对象需要保证都是同一个对象。如果只使用这两层缓存，在使用三级缓存中的工厂对象生成的动态代理对象都是新创建的，循环依赖的时候，注入到别的bean里面去的那个动态代理对象和最终这个bean在初始化后自己创建的bean地址值不一样。如果 Spring 选择二级缓存来解决循环依赖的话，那么就意味着所有 Bean 都需要在实例化完成之后就立马为其创建代理，而 Spring 的设计原则是在 Bean 初始化完成之后才为其创建代理。所以，Spring 选择了三级缓存。但是因为循环依赖的出现，导致了 Spring 不得不提前去创建代理，因为如果不提前创建代理对象，那么注入的就是原始对象，这样就会产生错误。</p><p>Prototype（原型）对象和单例对象的区别：</p><ul><li>单例对象在Spring加载的时候就创建，创建完毕后放入一级缓存中<li>而原型对象在每次在需要的时候都会创建，并且也不会存入缓存中<li>单例有状态（有状态指有成员变量并会进行修改操作）Bean对象的劣势：线程不安全。解决方案：考虑ThreadLocal（使用完后记得调用 ThreadLocal 的 remove 方法）或者锁机制。</ul><p>为什么Springboot默认创建单例Bean：</p><ul><li>不需要多次创建实例<li>减少垃圾回收<li>缓存中可以快速获得</ul><h2 id="拦截器与过滤器"><span class="mr-2">拦截器与过滤器</span><a href="#拦截器与过滤器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="不同点"><span class="mr-2">不同点</span><a href="#不同点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>过滤器基于函数回调，拦截器基于 Java 的反射机制<li>过滤器依赖于 servlet 容器，拦截器是 spring 组件，并不依赖于 servlet，因此先执行过滤器，再执行拦截器<li>过滤器几乎可以对所有进行容器的请求起作用，拦截器只会对 controller 中的请求起作用</ol><h3 id="使用场景"><span class="mr-2">使用场景</span><a href="#使用场景" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>过滤器：登陆校验、权限检查、性能监控<li>拦截器：接口限流</ol><p><a href="https://juejin.cn/post/6989944803874062366">容器注册组件的四种方式</a>：</p><ol><li>@Configuration + @Bean，注意，使用这种注册方法 Spring 会通过 CGLIB 来增强这个类，会判断是否实例已经存在，多次调用只会生成一个实例，意味着在@Configuration中的@Bean生成的是单例；相比之下，在@Component类中使用@Bean注解时，并不会有这种增强的行为。也就是说，当你在@Component类中调用一个@Bean方法时，实际上就是直接调用这个方法，并且每次调用都会创建一个新的 Bean，也就是说是生成多实例。<li>@ComponentScan + @Component<li>@Import<li>新建一个实现FactoryBean接口的类</ol><h2 id="configuration-和-component-的详细区别"><span class="mr-2">@Configuration 和 @Component 的详细区别</span><a href="#configuration-和-component-的详细区别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>@Configuration 中所有带 @Bean 注解的方法都会被动态代理（cglib），因此调用该方法返回的都是同一个实例。而 @Conponent 修饰的类不会被代理，每实例化一次就会创建一个新的对象。</p><p><a href="https://pdai.tech/md/spring/spring-x-framework-aop.html">面向切面编程（AOP）</a>也是一种设计思想，本质是为了解耦。其实现方式是动态织入，在运行时动态将要增强的代码织入到目标类中，借助动态代理技术完成的。并且接口与非接口的动态代理机制并不相同，如下所示：</p><ul><li>接口使用<strong>JDK代理</strong>，通过反射类Proxy以及拦截器的InvocationHandler回调接口实现的，使用反射，效率会低，不提供子类代理。<li>非接口使用<strong>CGlib代理</strong>，没有接口，只有实现类，采用底层字节码增强技术ASM在运行时使用Enhancer类创建目标的子类，提供子类代理。</ul><p>执行顺序：</p><ol><li>doAround(ProceedingJoinPoint pjp)的 pjp.proceed()<strong>前</strong>的内容<li>doBefore()<li>doAfterReturning(String result) / doAfterThrowing(Exception e)<li>doAfter()<li>doAround(ProceedingJoinPoint pjp)的 pjp.proceed()<strong>后</strong>的内容（当且仅当非异常情况下才会执行）</ol><p>注解：</p><ul><li><p>@Component修饰的类为组件类并为这个对象创建Bean，@Bean修饰的方法会生成一个对象Bean。</p><li><p>@SpringBootApplication 包含三个注解：</p><ol><li>@SpringBootConfiguration, 继承@Configuration，标注当前类是配置类，并会将当前类内声明的一个或多个以@Bean注解标记的方法的实例注册到spring容器中，并且实例名就是方法名。<li><a href="https://www.cnblogs.com/kevin-yuan/p/13583269.html">@EnableAutoConfiguration</a>，主要由 @AutoConfigurationPackage，@Import(EnableAutoConfigurationImportSelector.class)这两个注解组成的。<ol><li>@AutoConfigurationPackage 内部是 @({Registrar.class})，用于将启动类所在的包里面的所有组件注册到spring容器。扫描 @Entity, @Mapper 等第三方依赖注解。<li>@Import(EnableAutoConfigurationImportSelector.class) 是将特定路径（META-INF/spring.factories）中所有符合自动配置条件（@ConditionalOnClass）的类加载到Ioc容器，例如mybatis-spring-boot-starter。<code class="language-plaintext highlighter-rouge">AutoConfigurationImportSelector.java</code> 中可以看到所有自动配置类的名称。<a href="https://juejin.cn/post/7101477895331135495">自动配置类原理</a></ol><li>@ComponentScan，自动扫描并加载被@Component或@Repository修饰的组件，最终将这些组件加载到容器中，默认路径是该注解所在类的package。</ol></ul><h2 id="事务"><span class="mr-2">事务</span><a href="#事务" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>事务的几个参数：rollbackFor，propagation，isolation</p><h3 id="传播机制"><span class="mr-2">传播机制</span><a href="#传播机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>共有七种传播机制，大致上分为三类：</p><ol><li>支持当前事务<ol><li>REQUIRED：如果存在当前事务，加入该事务，否则创建新事务执行<li>SUPPORTS：如果存在当前事务，加入该事务，否则以非事务的方式执行<li>MANDATORY：如果存在当前事务，加入该事务，否则抛出异常</ol><li>不支持当前事务<ol><li>REQUIRES_NEW：如果存在当前事务，暂时挂起该事务，并且创建新事物执行。<strong>内层事务与外层事务就像两个独立的事务一样，一旦内层事务进行了提交后，外层事务不能对其进行回滚，两个事务互不影响。</strong><li>NOT_SUPPORTED：如果存在当前事务，暂时挂起该事务，否则以非事务的方式执行<li>NEVER：如果存在当前事务，抛出异常，否则以非事务的方式运行</ol><li>嵌套事务（NESTED）：如果存在当前事务，则创建新事物作为当前事务的嵌套事务执行，否则等价于REQUIRED。<strong>外层事务的回滚可以引起内层事务的回滚。而内层事务的异常并不会导致外层事务的回滚。</strong></ol><p><a href="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202411111929924.png" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CompetitiveLin/ImageHostingService/picgo/imgs/202411111929924.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="事务失效"><span class="mr-2">事务失效</span><a href="#事务失效" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>数据库引擎不支持（MyIsam）<li>没有注册成Bean被Spring管理（没有使用@Service等注解）<li>方法不是public或者被final修饰（无法生成代理类）<li><a href="https://juejin.cn/post/6844903908892999687">方法内部调用</a>(解决方法是引入自身Bean)<li>异常被捕捉或抛出其他类型的异常（回滚的默认异常为RuntimeException）<li>未开启事务</ol><h3 id="方法调用的事务回滚情况"><span class="mr-2">方法调用的事务回滚情况</span><a href="#方法调用的事务回滚情况" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>前提：a方法调用b方法</p><div class="table-wrapper"><table><thead><tr><th>a<th>b<th>报错情况<th>同类调用的现象<th>不同类调用的现象<tbody><tr><td>transactional注解<td>无注解<td>a方法报错，b方法不报错<td>均回滚<td>均回滚<tr><td>transactional注解<td>无注解<td>a方法不报错，b方法报错<td>均回滚<td>均回滚<tr><td>无注解<td>transactional注解<td>a方法报错，b方法不报错<td>均不回滚<td>均不回滚<tr><td>无注解<td>transactional注解<td>a方法不报错，b方法报错<td>均不回滚<td>a不回滚，b回滚</table></div><p>结论：</p><ol><li>transactional注解修饰的方法会创建一个代理增强类，其他方法调用该注解修饰的方法也只是调用原类中的方法。<li>transactional修饰的方法内报错就一定会回滚。</ol><h1 id="spring-用到了哪些设计模式">Spring 用到了哪些设计模式</h1><ol><li>工厂模式：通过 BeanFactory 和 ApplicationContext 容器创建 Bean 对象<li>代理模式：AOP 的实现<li>单例模式：Bean 默认是单例<li>模板方法：jdbcTemplate 等用到了模板方法<li>观察者模式：Springboot 事件驱动，监听器等</ol></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/backend/" class="post-tag no-text-decoration" >backend</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SpringBoot%20-%20Blogs&url=%2Fposts%2Fspringboot%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SpringBoot%20-%20Blogs&u=%2Fposts%2Fspringboot%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fspringboot%2F&text=SpringBoot%20-%20Blogs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/elasticsearch/">ElasticSearch</a><li><a href="/posts/note-from-work/">Note from Work</a><li><a href="/posts/redis/">Redis 知识体系</a><li><a href="/posts/springboot/">SpringBoot</a><li><a href="/posts/go/">Go 语言学习</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/kafka-vs-rocketmq/"><div class="card-body"> <em class="small" data-ts="1692954622" data-df="ll" > Aug 25, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka vs RocketMQ</h3><div class="text-muted small"><p> 基本概念 RocketMQ 由 Producer, Brocker, Consumer 组成 Producer 负责生产消息 Consumer 负责消费消息 Broker 负责存储消息，每一个 Broker 对应一台服务器但可以存储多个 Topic 的消息，每个 Topic 的消息也分片存储在不同的 Broker 里。 ...</p></div></div></a></div><div class="card"> <a href="/posts/note-from-work/"><div class="card-body"> <em class="small" data-ts="1694054482" data-df="ll" > Sep 7, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Note from Work</h3><div class="text-muted small"><p> Grafana 的数据显示会五分钟自动补全。当向 Prometheus 中插入某个时间戳的值时，其值会延续五分钟。 K8S 中的 Sidecar 模式：通常情况下一个 Pod 只包含一个容器，但是 Sidecar 模式是指为主容器提供额外功能（例如监控） 从而将其他容器加入到同一个 Pod 中。再例如 Istio 实现 Sidecar 自动注入。 ...</p></div></div></a></div><div class="card"> <a href="/posts/java/"><div class="card-body"> <em class="small" data-ts="1655792594" data-df="ll" > Jun 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basics of Java</h3><div class="text-muted small"><p> 基本知识 三大特点：封装继承多态。 语法糖：switch支持String、泛型、自动拆装箱、变长参数、枚举、内部类、条件编译、断言、数值下划线、for-each、try-with-resources、Lambda表达式 装箱：Integer i = Integer.valueOf(10)， 拆箱：int n = i.intValue() 反射：指动态获取的信息以及动态调用对象的方法的...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/elasticsearch/" class="btn btn-outline-primary" prompt="Older"><p>ElasticSearch</p></a> <a href="/posts/kafka-vs-rocketmq/" class="btn btn-outline-primary" prompt="Newer"><p>Kafka vs RocketMQ</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "CompetitiveLin/CompetitiveLin.github.io", "data-repo-id": "R_kgDOG9EeyQ", "data-category": "General", "data-category-id": "DIC_kwDOG9Eeyc4CN-ne", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/CompetitiveLin">CompetitiveLin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
