<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Note from Work" /><meta property="og:locale" content="en" /><meta name="description" content="Grafana 的数据显示会五分钟自动补全。当向 Prometheus 中插入某个时间戳的值时，其值会延续五分钟。" /><meta property="og:description" content="Grafana 的数据显示会五分钟自动补全。当向 Prometheus 中插入某个时间戳的值时，其值会延续五分钟。" /><link rel="canonical" href="/posts/note-from-work/" /><meta property="og:url" content="/posts/note-from-work/" /><meta property="og:site_name" content="Blogs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-09-07T10:41:22+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Note from Work" /><meta name="twitter:site" content="@CompetitiveLin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-20T20:46:20+08:00","datePublished":"2023-09-07T10:41:22+08:00","description":"Grafana 的数据显示会五分钟自动补全。当向 Prometheus 中插入某个时间戳的值时，其值会延续五分钟。","headline":"Note from Work","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/note-from-work/"},"url":"/posts/note-from-work/"}</script><title>Note from Work | Blogs</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Blogs"><meta name="application-name" content="Blogs"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avator.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Blogs</a></div><div class="site-subtitle font-italic">Recording everything in here.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/CompetitiveLin" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/CompetitiveLin" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['zee_lin','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Note from Work</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Note from Work</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1694054482" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 7, 2023 </em> </span> <span> Updated <em class="" data-ts="1745153180" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 20, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/CompetitiveLin">CompetitiveLin</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="8175 words"> <em>45 min</em> read</span></div></div></div><div class="post-content"><ol><li><p>Grafana 的数据显示会五分钟自动补全。当向 Prometheus 中插入某个时间戳的值时，其值会延续五分钟。</p><li><p>K8S 中的 Sidecar 模式：通常情况下一个 Pod 只包含一个容器，但是 Sidecar 模式是指为主容器<strong>提供额外功能（例如监控）</strong> 从而将其他容器加入到同一个 Pod 中。再例如 <a href="https://juejin.cn/post/6951567887664414757">Istio 实现 Sidecar 自动注入</a>。</p><li><p>Federated cluster，联邦集群</p><li><p>限流算法：漏桶和令牌桶算法，漏桶算法处理请求的速度固定，突发请求过多时会丢弃；令牌桶算法除了限制数据的平均传输速率外，还要求允许某种程度的突发传输。</p><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">常见 HTTP 状态码</a>：2XX，成功响应；3XX，重定向消息；4XX，客户端错误响应；5XX，服务端错误响应。</p><li><p>请求分为四部分：请求行，请求头，空行，请求正文（不一定有）。</p><li><p><code class="language-plaintext highlighter-rouge">.gitignore</code> 是在文件从工作区被 <strong>add</strong> 到暂存区时判断是否要被忽略，对于已经在暂存区的文件，不作判断。</p></ol><h2 id="限流算法"><span class="mr-2">限流算法</span><a href="#限流算法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>固定窗口：借助 Redis 的 String 数据结构，每次请求 value 自增，并设置过期时间<li>滑动窗口：借助 Redis 的 Zset 数据结构，以时间戳作为 score，每次请求使用 Zcount 查找窗口内的成员数量<li>漏桶：记录上次请求时间戳、当前剩余水量和容量，每次请求计算当前剩余水量减去时间差乘以每秒处理数，判断是否小于容量，是则放行并增加水量，不是则限流<li>令牌桶：记录上次请求时间戳、当前令牌桶数量和容量，每次请求计算当前令牌数量与时间差乘以每秒放入令牌数的和，如果当前令牌数大于零，则令牌数减一并放行，否则限流</ol><h2 id="cookie-和-session-的区别"><span class="mr-2">Cookie 和 Session 的区别</span><a href="#cookie-和-session-的区别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>存储位置：Cookie 存储在客户端，Session 存储在服务端<li>存取方式：Cookie 只能保存 ASCII，Session 可以存任意数据类型，比如 UserId 等<li>有效期：Cookie 可以长时间保持，Session 在客户端关闭的时候会失效<li>存储大小：单个 Cookie 大小不超过 4KB，Session 则没有限制</ol><h2 id="数据结构"><span class="mr-2">数据结构</span><a href="#数据结构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="红黑树特性"><span class="mr-2">红黑树特性</span><a href="#红黑树特性" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>节点非红即黑<li>根节点是黑色<li>叶子节点是黑色的空节点<li>红节点的子节点是黑节点<li>从根节点到空节点的每条路径，包含相同数量的黑色节点</ol><h2 id="常见nosql数据库类型"><span class="mr-2">常见NoSQL数据库类型</span><a href="#常见nosql数据库类型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>键值数据库：Redis<li>列式数据库：HBase, ClickHouse，适用于联机分析处理（OLAP）场景，数仓等<li>文档数据库：MongoDB, ElasticSearch<li>图数据库</ol><p>Clickhouse：</p><ol><li>不支持事务：因为面向列。不存在隔离级别。ClickHouse的定位是分析性数据库，而不是严格的关系型数据库<li>不支持高并发<li>可处理大量读请求，数据压缩的特性</ol><h2 id="分布式理论"><span class="mr-2">分布式理论</span><a href="#分布式理论" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="两阶段协议"><span class="mr-2">两阶段协议</span><a href="#两阶段协议" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>https://juejin.cn/post/6844903621495095309</p><h3 id="三阶段协议"><span class="mr-2">三阶段协议</span><a href="#三阶段协议" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>https://juejin.cn/post/6844903621495111688</p><h3 id="flp-不可能性原理"><span class="mr-2">FLP 不可能性原理</span><a href="#flp-不可能性原理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>在网络可靠，存在节点失效（即便只有一个）的最小化异步模型系统中，不存在一个可以解决一致性问题的确定性算法。对于允许节点失效情况下，纯粹异步系统无法确保一致性在有限时间内完成。</p><p>举例：三个人在不同房间，进行投票（投票结果是 0 或者 1）。三个人彼此可以通过电话进行沟通，但经常会有人时不时地睡着。比如某个时候，A 投票 0，B 投票 1，C 收到了两人的投票，然后 C 睡着了。A 和 B 则永远无法在有限时间内获知最终的结果。</p><h3 id="cap-定理"><span class="mr-2">CAP 定理</span><a href="#cap-定理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>分布式系统只能交付以下三个所需特性中的两个特性：一致性、可用性和分区容错性。</p><ul><li>C（Consistency）：一致性，指的是所有客户端可以同时看到相同的数据。每当数据写入一个节点时，就必须立即将其转发或复制到系统中的所有其他节点<li>A（Availability）：可用性，指的是可用性表示发出数据请求的任何客户端都会得到响应，即使一个或多个节点宕机。<li>P（Partition tolerance）：分区容错性，指分区之间的通信可能失败。</ul><p>一般来说，在分布式系统中不可避免会出现分区，因此认为 P 总是成立。因此若要实现一致性（CP），那么当出现分区问题时，就需要舍弃不一致的节点，即牺牲可用性。同理，若要实现可用性（AP），那么当出现分区问题时，就无法保证一致性。</p><p>Nacos集群默认是基于 Distro 协议的 AP 原则（即不支持数据一致性，支持服务注册的临时实例），但也可切换至基于 Raft 的 CP 原则（支持服务注册的永久实例）。</p><p>临时实例和持久化实例的区别：</p><ul><li>持久化实例健康检查后会被标记为不健康，而临时实例会直接从列表中删除。</ul><p>MongoDB 是一种 CP 数据存储——它通过牺牲可用性、保持一致性来解决网络分区问题。</p><h3 id="base-理论"><span class="mr-2">BASE 理论</span><a href="#base-理论" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Basically Available(基本可用)，假设系统出现了不可预知的故障，但还是能用。<li>Soft State（软状态），允许系统在多个不同节点的数据副本存在数据延时。<li>Eventually Consistent（最终一致性），在软状态的一定期限过后，应达到数据的最终一致性。</ul><p>核心思想是：即使无法做到强一致性（Strong consistency），但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性（Eventual consistency）。</p><h3 id="raft-算法"><span class="mr-2">Raft 算法</span><a href="#raft-算法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://thesecretlivesofdata.com/raft/">可视化链接</a></p><p>三种角色：</p><ol><li>Leader，发送心跳包以维护自己的Leader状态<li>Follower，响应Leader发送的心跳包<li>Candidate，如果没有接收到Leader的心跳信号后，Follower会变成Candidate并向其他节点发送拉票信息</ol><p>记时器：</p><ol><li>选举超时时间（Follower拥有）：若超时前没有收到心跳包，认为Leader下线，此时Follower会变成Candidate；但反之如果接收到心跳包，则重置计时器。<li>投票超时时间（Candidate拥有）：若超时前没有得到半数以上的票数，则竞选失败；反之成功。<li>竞选等待超时时间（竞选失败的Follower拥有）：竞选失败的Follower需要等待一段时间后才能重新竞选。</ol><h3 id="脑裂"><span class="mr-2">脑裂</span><a href="#脑裂" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>由于某种原因（网络不稳定）使得主从集群一分为二，导致master或者leader节点的数量不为1（0或2）。</p><ul><li>redis脑裂</ul><p>master 机器突然脱离网络，使得 sentinel 集群无法感知到 master 的存在，会重新选举一个 master 节点。网络恢复后则会存在两个 master 节点。</p><ul><li>zookeeper脑裂</ul><p>脑裂可能出现平票的情况，从而无法选举出 leader。因此，zk 中建议节点数是奇数。</p><h1 id="k8s">K8s</h1><p>Kubernetes主要由以下几个核心组件组成：</p><ul><li>etcd保存了整个集群的状态；<li>apiserver提供了资源操作的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制；<li>controller manager负责维护集群的状态，比如故障检测、自动扩展、滚动更新等；<li>scheduler负责资源的调度，按照预定的调度策略将Pod调度到相应的机器上；<li>kubelet负责维持容器的生命周期，同时也负责Volume（CVI）和网络（CNI）的管理；<li>Container runtime负责镜像管理以及Pod和容器的真正运行（CRI）；<li>kube-proxy负责为Service提供cluster内部的服务发现和负载均衡；</ul><p>除了核心组件，还有一些推荐的add-ons（扩展）：</p><ul><li>kube-dns负责为整个集群提供DNS服务<li>Ingress Controller为服务提供外网入口<li>Heapster提供资源监控<li>Dashboard提供GUI<li>Federation提供跨可用区的集群<li>Fluentd-elasticsearch提供集群日志采集、存储与查询</ul><h1 id="23种设计模式与六大原则">23种设计模式与六大原则</h1><h2 id="23种设计模式"><span class="mr-2">23种设计模式</span><a href="#23种设计模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>创建型<ol><li>单例模式（Singleton）<ul><li>饿汉模式：类加载的时候就创建实例<li>懒汉模式：只有当第一次使用的时候才创建实例<li>双重校验锁：线程安全，实例需要用 <code class="language-plaintext highlighter-rouge">volatile</code> 修饰</ul><li>原型模式（Prototype），能够复制已有对象，而又无需使代码依赖它们所属的类。例如 <code class="language-plaintext highlighter-rouge">Cloneable</code> 接口是立即可用的原型模式。<li>工厂方法模式（Factory Method），在父类中提供一个创建对象的方法， 允许子类决定实例化对象<li>抽象工厂模式（Abstract Factory），定义了用于创建不同产品的<strong>接口</strong>， 但将实际的创建工作留给了具体工厂类。 每个工厂类型都对应一个特定的产品变体。<li>建造者模式（Builder），分步骤创建复杂对象。</ol><li>行为型<ol><li>模板方法模式（Template Method），它在基类中定义了一个算法的框架，允许子类在不修改结构的情况下重写算法的特定步骤。<li>责任链模式（Chain of Responsibility），它让多个处理器（对象节点）按顺序处理该请求，直到其中某个处理成功为止，例如检查商品模块，需要先检查商品合法性，再检查商品可见性等等。<li>命令模式（Command）<li>迭代器模式（Iterator），能在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。<li>中介者模式（Mediator）<li>备忘录模式（Memeoto）<li>观察者模式（Observer）<li>状态模式（State）<li>策略模式（Strategy），规定每个策略的不同方法，只需选择不同的策略即可执行不同的方法，例如数字人项目中 Provider 的选择（1：AiLab，2：Creatify，3：IC，4：IC-NEW）<li>访问者模式（Visitor）<li>解释器模式（Interpreter）</ol><li>结构型<ol><li>适配器模式（Adaptor）<li>桥接模式（Bridge）<li>组合模式（Composite）<li>装饰模式（Decorator）<li>外观模式（Facade），为复杂系统、程序库或框架提供一个简单的接口。通常作用于整个对象子系统上。<li>享元模式（Flyweight），共享多个对象的部分状态将内存消耗最小化。<li>代理模式（Proxy），例如动态代理</ol></ul><h2 id="六大原则"><span class="mr-2">六大原则</span><a href="#六大原则" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>开闭原则，对扩展开放，对修改关闭。<li>单一职责原则，顾名思义，一个类的职责只有有一个。<li>里氏替换原则，子类可以扩展父类的功能，但不能改变父类原有的功能。<li>依赖倒转原则，依赖于抽象，不能依赖于具体实现（面向接口编程）。<li>接口隔离原则，类之间的依赖关系应该建立在最小的接口上。<li>迪米特原则，一个软件实体应当尽可能少的与其他实体发生相互作用。</ol><h2 id="分布式事务-seata"><span class="mr-2">分布式事务 Seata</span><a href="#分布式事务-seata" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>分两阶段提交</p><ol><li>TC (Transaction Coordinator) - 事务协调者：维护全局和分支事务的状态，驱动全局事务提交或回滚。<li>TM (Transaction Manager) - 事务管理器：定义全局事务的范围：开始全局事务、提交或回滚全局事务。<li>RM (Resource Manager) - 资源管理器：管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</ol><p>执行流程：</p><ol><li>TM 向 TC 请求发起(Begin)、提交(Commit)、回滚(Rollback)等全局事务。<li>TM 把代表全局事务的XID绑定到分支事务上。<li>RM 向 TC 注册，把分支事务关联到XID代表的全局事务中。<li>RM 把分支事务的执行结果上报给 TC。<li>TC 发送分支提交（Branch Commit）或分支回滚（Branch Rollback）命令给RM。</ol><p><a href="https://www.51cto.com/article/713007.html">四大模式</a>：</p><ol><li>AT模式，能适用于大部分事务情况。<li>XA模式<li>SAGA模式，核心思想是将长事务拆分成多个本地短事务。<li>TCC模式，核心思想是针对每个操作都要注册一个与其对应的确认和补偿操作。</ol><p>其他分布式事务解决方案：</p><ol><li>基于 RocketMQ 的消息事务<li>二阶段提交<li>三阶段提交，CanCommit、PreCommit、DoCommit三阶段</ol><h2 id="zookeepercp"><span class="mr-2">ZooKeeper（CP）</span><a href="#zookeepercp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>使用 ZAB 协议，包括两种运行模式：</p><ol><li><p>消息广播（Leader 正常运行），所有事务请求由单一主进程处理，Leader 转换为事务 Proposal 并广播分发给 Follower，Leader 等待 Follower 的反馈，超过半数的 Follower 反馈消息后，Leader 再发送 Commit 消息提交事务 Proposal。</p><li><p>崩溃恢复（Leader 不可用时），新选举产生的 Leader 与过半的 Follower 进行同步，使数据一致，同步后进入消息广播模式。</p></ol><p>主要服务于分布式系统，可以用ZooKeeper来做：统一配置管理、统一命名服务、<a href="https://blog.csdn.net/weixin_40149557/article/details/117268491">分布式锁</a>、集群管理，用来解决分布式集群中应用系统的一致性问题，构建 ZooKeeper 集群时使用的服务器最好是奇数台。其设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以一系列简单易用的接口提供给用户使用。</p><p>数据结构：Znode节点，与Unix文件系统类似，通过路径来标识，例如 <code class="language-plaintext highlighter-rouge">/home/app</code>，Znode节点又分为两种类型：临时节点、持久节点、临时顺序节点、持久顺序节点。客户端和服务端断开连接后，临时节点会自动删除但持久节点不会。<a href="https://www.51cto.com/article/687086.html">分布式锁使用的是临时节点</a>。</p><p>Watcher 监听器：节点的数据发生变化后会通知到节点的监听器。</p><p>基本命令：</p><ul><li>create : 在树中的某个位置创建一个节点<li>delete : 删除一个节点存在：测试节点是否存在于某个位置<li>get data : 从节点读取数据<li>set data： 将数据写入节点<li>get children : 检索节点的子节点列表<li>sync : 等待数据被传播</ul><p>实现分布式锁原理：判断能否创建临时节点，如果不能则监听父节点（非公平锁）或上一个节点（公平锁），任务执行完成后释放该节点并通知所有监听的节点。</p><p>实现注册中心原理：初始化时 Provider 先向目录写入 URL 地址，Consumer 订阅相同目录的 URL 地址和自己的 URL 地址，监控中心订阅 Provider 和 Consumer 的 URL 地址；Consumer 在第一次调用服务时，会通过注册中心找到相应的服务的IP地址列表，并缓存到本地，以供后续使用；当 Provider 下线时，会在列表中移除 URL 并将新的 URL 地址发送给 Consumer 并缓存至本地，服务上线也是一样的。</p><p><a href="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76e2b26a0fdd40ff9bc96837b4865dba~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" class="popup img-link "><img data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76e2b26a0fdd40ff9bc96837b4865dba~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp" alt="" class="lazyload" data-proofer-ignore></a></p><p>与 Nacos 的区别：</p><p>Nacos 是 AP 的，保证可用性，每个节点都是平等的，若干个节点 crash 后不会影响正常节点，但查到的信息不一定是最新的。ZK 在 crash 后进行 leader 选举，期间是不可用的。</p><h2 id="微服务框架dubbo"><span class="mr-2">微服务框架：Dubbo</span><a href="#微服务框架dubbo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>底层基于 Netty 的 NIO 框架，基于 TCP 协议传输</p><h3 id="四种负载均衡策略"><span class="mr-2">四种负载均衡策略</span><a href="#四种负载均衡策略" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>支持服务端服务级别、服务端方法级别、客户端服务级别、客户端方法级别的负载均衡配置。还可以拓展负载均衡算法。</p><ol><li>随机负载均衡，<strong>默认</strong>策略<li>轮询负载均衡<li>最少活跃调用数，每个 Provider 都有一个计数器，开始调用则计数器加一，结束调用计数器减一。原则是将请求分配给处理速度快的 Provider。<li>一致性哈希负载均衡</ol><h3 id="https-如何保证可靠传输"><span class="mr-2">HTTPS 如何保证可靠传输</span><a href="#https-如何保证可靠传输" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>TLS 协议：</p><ol><li>对称加密/非对称加密<li>数字证书<li>三次握手/四次挥手</ol><p>TLS 的 rsa 握手过程，存在什么安全隐患，怎么解决的？</p><ul><li>安全隐患：不支持前向保密。如果私钥泄露了，所有密文都会被破解<li>解决方案：密钥协商算法</ul><h4 id="https-绝对安全吗"><span class="mr-2">HTTPS 绝对安全吗</span><a href="#https-绝对安全吗" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>NO，可以通过<strong>中间人攻击</strong>的方式，即所有请求先发送给第三方（中间人），返回中间人的证书，后续的请求/响应都通过中间人进行转发。</p><h2 id="http版本的演变"><span class="mr-2">HTTP版本的演变</span><a href="#http版本的演变" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="http10"><span class="mr-2">HTTP/1.0</span><a href="#http10" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>无状态：服务器不追踪不记录请求过的状态<li>无连接：每次请求要建立连接，无法复用连接；在前一个请求响应到达之后下一个请求才能发送，如果前一个阻塞，后面的请求也被阻塞</ul><h3 id="http11"><span class="mr-2">HTTP/1.1</span><a href="#http11" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>默认浏览器对同一域名的并发请求限制为 6 - 8 个。</p><ul><li>长连接：默认保持长连接，数据传输完成后只要不断开连接，就可以继续传输数据<li>管道化：基于上面长连接的基础，可以不等第一个请求响应继续发送后面的请求，但响应的顺序还是按照请求的顺序返回<li>缓存处理：新增字段cache-control<li>断点传输：在上传/下载资源时，如果资源过大，将其分割为多个部分，分别上传/下载</ul><h3 id="http2"><span class="mr-2">HTTP/2</span><a href="#http2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>二进制分帧传输：更方便头部，只传输差异部分<li>多路复用：同一服务下只需要用一个连接，节省了连接<li>头部压缩：合并同时发出请求的相同部分<li>服务器推送：一次客户端请求服务端可以多次响应</ul><h3 id="http3"><span class="mr-2">HTTP/3</span><a href="#http3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>基于谷歌的QUIC，底层使用udp代码tcp协议，解决了队头阻塞问题，同样无需握手，性能大大地提升，默认使用tls加密。</p><h2 id="进程和线程"><span class="mr-2">进程和线程</span><a href="#进程和线程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="进程拥有的资源"><span class="mr-2">进程拥有的资源</span><a href="#进程拥有的资源" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>进程控制块<li>文件描述符<li>网络连接<li>设备</ol><p>区别：</p><ol><li>进程是系统资源分配的最小单位，实现了操作系统的并发；线程是CPU调度的最小单位，实现了进程内部的并发。<li>进程在执行过程中拥有独立的内存单元，而多个线程共享进程的内存。<li>进程切换的开销远大于线程切换的开销。<li>进程之间不会相互影响，但线程挂掉会影响整个进程。</ol><p>进程间通信方式：</p><ol><li>管道<li>信号量<li>消息队列<li>共享内存<li>套接字，也可以用于不同主机之间进程的通信</ol><p>线程间通信方式：</p><ol><li>共享内存，比如 volatile 保证内存的可见性。<li>消息传递，比如 wait/notify/notifyAll 等待通知方式和 join 方式。<li>管道流</ol><h2 id="用户态和内核态"><span class="mr-2">用户态和内核态</span><a href="#用户态和内核态" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>为什么要有这两个状态？保护机制，防止用户误操作或恶意破坏系统</p><h3 id="用户态"><span class="mr-2">用户态</span><a href="#用户态" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>是用户进程/线程所在的区域，主要用于执行用户程序<li>运行的代码会受到CPU的很多检查，不能直接访问内核数据<li>只拥有受限的权限<li>只能响应部分中断请求<li>只能访问受限的地址空间</ol><h3 id="内核态"><span class="mr-2">内核态</span><a href="#内核态" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>是内核进程/线程所在的区域，主要用于执行操作系统程序，硬件交互<li>运行的代码不受任何限制，可以执行任意指令<li>拥有最高权限<li>可以响应所有中断请求<li>可以访问所有内存空间</ol><h3 id="用户态切换到内核态"><span class="mr-2">用户态切换到内核态</span><a href="#用户态切换到内核态" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>系统调用（主动）。操作系统在执行用户程序的时候主要工作在用户态，当执行没有权限的任务时，才切换到内核态。<li>异常（被动）。执行用户程序出现异常时，会从用户态切换到内核态处理异常<li>外围设备中断（被动）。中断发生时，如果中断之前在运行用户态的程序，那么会切换至内核态处理中断。</ol><h2 id="服务注册与发现"><span class="mr-2">服务注册与发现</span><a href="#服务注册与发现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>如果自己实现服务注册与发现，需要考虑以下三点：</p><ol><li>Register, 服务启动时候进行注册<li>Query, 查询已注册服务信息<li>Healthy Check, 确认服务状态是否健康</ol><p>实现方案：</p><ol><li>Eureka，AP<li>ZooKeeper，CP，Paxos 算法<li>Consul，CP，Raft 算法<li>Etcd，CP，Raft 算法</ol><p>Paxos 和 Raft 算法都属于一致性算法，所以是保证 CP</p><p>实际上，作为一个注册中心来说，保证 AP 更加重要，即可用性。</p><h3 id="两种模式"><span class="mr-2">两种模式</span><a href="#两种模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>客户端发现模式，首先要进行的是到服务注册中心获取服务列表，然后再根据调用端本地的负载均衡策略，进行服务调用。<li>服务端发现模式，调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，对微服务进行调用。这个模式下，调用方不需要在自身节点维护服务发现逻辑以及服务注册信息。</ol><h2 id="常见的负载均衡"><span class="mr-2">常见的负载均衡</span><a href="#常见的负载均衡" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>轮询，按照请求的顺序轮流分配到不同的服务器，循环往复。<li>加权轮询，给不同的服务器分配不同的权重，根据权重比例来决定分配请求的数量。<li>最小连接数<li>最短响应时间<li>IP哈希</ol><h1 id="rpchttp">RPC/HTTP</h1><p>与 HTTP 的对比，RPC 使用二进制传输，传输效率高（HTTP额外空间开销大，包含大量元数据，头字段等），但通用性不如 HTTP 协议</p><h2 id="核心"><span class="mr-2">核心</span><a href="#核心" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>消息协议：以何种方式打包编码和拆包解码<li>传输控制：主要有HTTP传输和TCP传输，鉴于TCP传输的可靠性，RPC的传输一般使用TCP作为传输协议</ol><h2 id="工作流程"><span class="mr-2">工作流程</span><a href="#工作流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>客户端（Client）以本地方法调用服务<li>客户端存根（Client Stub）收到调用后把方法、参数等内容打包成特定格式、能进行网络传输的消息体（Marshalling）<li>客户端存根找到服务地址，发送给服务端（这个过程可以基于TCP也可以基于HTTP）<li>服务端存根（Server Stub）收到消息后拆包解码（Unmarshalling）<li>服务端存根根据方法名和参数进行本地调用服务<li>服务端（Server）本地执行后把结果返回给服务端存根<li>服务端存根把结果打包发送给客户端存根<li>客户端存根接收到消息进行解码<li>客户端得到最终结果</ol><h2 id="实现方式"><span class="mr-2">实现方式</span><a href="#实现方式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>基于 http<li>基于 tcp（常见）</ol><h1 id="计算机网络">计算机网络</h1><h2 id="最大-tcp-连接数量"><span class="mr-2">最大 TCP 连接数量</span><a href="#最大-tcp-连接数量" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>一台机器作为客户端和服务端时，能建立的最大 TCP 连接数量不同。</p><h3 id="客户端"><span class="mr-2">客户端</span><a href="#客户端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>单个 IP 的情况下，受内核参数 <code class="language-plaintext highlighter-rouge">net.ipv4.ip_local_port_range</code> 的限制，范围为0 ~ 65535，但一般默认在 3w ~ 5w 之间。但多网卡的情况下可以有多个 IP，因此最大连接数的理论值以线性增长。</p><h3 id="服务端"><span class="mr-2">服务端</span><a href="#服务端" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>理论上连接数为 2^32 （IP数量） * 2^16（端口数量）* 2^16 （服务端口数量）。但每个 TCP 连接需要消耗内存 3.3 K 左右，因此实际上最大建立连接数为内存大小 / 3.3K，假设 4GB 内存，最大连接数为 100 万个左右。</p><h2 id="tcpudp-可以使用同一个端口吗"><span class="mr-2">TCP/UDP 可以使用同一个端口吗</span><a href="#tcpudp-可以使用同一个端口吗" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>可以。传输层有两个传输协议分别是 TCP 和 UDP，在内核中是两个完全独立的软件模块。可以在 IP 包头的<strong>协议号</strong>字段判断出 TCP 还是 UDP</p><h2 id="tcp-三次握手"><span class="mr-2">TCP 三次握手</span><a href="#tcp-三次握手" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="为什么三次握手"><span class="mr-2">为什么三次握手</span><a href="#为什么三次握手" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>因为三次握手才能保证<strong>双方具有接收和发送的能力</strong>，并且防止重复建立历史连接。</p><h3 id="为什么四次挥手"><span class="mr-2">为什么四次挥手</span><a href="#为什么四次挥手" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>本质原因是 TCP 是全双工通信，客户端确认没有数据发送后，发出结束报文，此时服务端返回确认后，服务端也不会接收客户端数据。但是此时服务端可能还有数据没有传输完，客户端还是可以接收数据。</p><p>如果挥手过程中「没有数据要发送」并且「开启了 TCP 延迟确认机制」，那么第二和第三次挥手就会合并传输，这样就出现了<strong>三次挥手</strong>。</p><h2 id="dns使用tcp还是udp"><span class="mr-2">DNS使用TCP还是UDP</span><a href="#dns使用tcp还是udp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>DNS 在进行区域传输的时候使用 TCP，其他情况使用 UDP。</p><p>区域传输：是指DNS主从服务器之间的数据同步，保证数据的一致性，传送会利用DNS域，所以就称为DNS区域传送。</p><h2 id="tcp-保证可靠传输"><span class="mr-2">TCP 保证可靠传输</span><a href="#tcp-保证可靠传输" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>序列号<li>连接建立：三次握手四次挥手<li>头部检验和<li>确认应答<li>超时重传<li>拥塞控制：四种算法<ol><li>慢启动<li>拥塞避免<li>拥塞发生<li>快速恢复</ol><li>流量控制：滑动窗口实现</ol><h2 id="osi-七层模型和-tcpip-四层模型"><span class="mr-2">OSI 七层模型和 TCP/IP 四层模型</span><a href="#osi-七层模型和-tcpip-四层模型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>应用层：HTTP，DNS，FTP，WebSocket；网关<ol><li>应用层<li>表示层<li>会话层</ol><li>传输层：TCP，UDP；网关<li>网络层：IP（在TCP/IP模型中，ARP属于网络层）；路由器<li>网络接口层<ol><li>数据链路层：ARP；网桥，交换机<li>物理层：网卡；中继器，集线器</ol></ol><h1 id="架构">架构</h1><p>在高并发环境下，服务之间的依赖关系导致调用失败，解决的方式通常是: 限流-&gt;熔断-&gt;隔离-&gt;降级, 其目的是防止雪崩效应。</p><h1 id="死锁">死锁</h1><p>四个条件：</p><ol><li>互斥<li>请求和保持<li>不可剥夺<li>循环等待</ol><h1 id="一致性哈希">一致性哈希</h1><p>一致性哈希是指将「存储节点」和「数据」都映射到一个首尾相连的哈希环（固定大小）上。数据存储在哈希值通过<strong>顺时针</strong>找到的第一个节点。</p><h2 id="优势"><span class="mr-2">优势</span><a href="#优势" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>一致性哈希算法是对 <code class="language-plaintext highlighter-rouge">2^32</code> 取模，是一个固定的值；而普通哈希表的长度是由节点数决定的。</p><ul><li>普通哈希函数，如果节点数量发生了变化（对系统进行扩容缩容的时候），大部分改变了映射关系，因此需要迁移大量的数据。<li>一致性哈希算法，如果节点数量发生了变化，只影响该节点顺时针相邻的后继节点。</ul><h2 id="虚拟节点的引入"><span class="mr-2">虚拟节点的引入</span><a href="#虚拟节点的引入" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>一致性哈希算法并不保证节点能够在哈希环上分布均匀，因此引入均匀分布的虚拟节点，建立真实节点和虚拟节点的映射关系。</p><h1 id="io">IO</h1><ol><li>同步<ol><li>同步阻塞IO<li>同步非阻塞IO<li>IO多路复用<li>信号驱动IO</ol><li>异步<ol><li>异步IO</ol></ol><h2 id="虚拟内存"><span class="mr-2">虚拟内存</span><a href="#虚拟内存" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>虚拟内存是一种计算机技术，它允许系统将一部分硬盘空间当作RAM（随机存取存储器）使用。当物理内存不足以支持正在运行的应用程序时，系统会将不常用的数据移动至磁盘中。虚拟内存为每个进程提供了一个一致的、私有的地址空间</p><h2 id="32位64位操作系统的区别"><span class="mr-2">32位/64位操作系统的区别</span><a href="#32位64位操作系统的区别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>32位/64位表示CPU可以处理最大位数，一次性的运算量不一样，寻址能力也不同。</p><h1 id="域名解析流程">域名解析流程</h1><ol><li>检查缓存<ol><li>浏览器缓存<li>操作系统缓存<li>本地 hosts 文件</ol><li>主机使用递归查询向本地域名服务器查询<li>本地域名服务器使用迭代查询向根服务器查询<ol><li>根域名服务器(.)<li>顶级域名服务器(.com)<li>二级域名服务器(google.com)</ol></ol><h1 id="排查-cpu-占用过高和内存溢出的问题">排查 CPU 占用过高和内存溢出的问题</h1><h2 id="java"><span class="mr-2">Java</span><a href="#java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>CPU 占用排查：使用 <code class="language-plaintext highlighter-rouge">top</code> 和 <code class="language-plaintext highlighter-rouge">top -Hp xxx</code> 命令定位占用率最高的进程和该进程的线程 内存占用排查：<code class="language-plaintext highlighter-rouge">jstack</code>， <code class="language-plaintext highlighter-rouge">jmap</code> 打印出堆栈信息， <code class="language-plaintext highlighter-rouge">jstat</code> 查看垃圾回收的情况</p><ul><li>Jstat 可以查看新生代的两个S0、s1区、Eden区，以及老年代的内存使用率，还有young gc以及full gc的次数。<li>Jmap 可以查看当前堆中所有每个类的实例数量和内存占用，也可以 dump 内存快照，再由 VituralVM 或 MAT 软件可视化查看。</ul><h2 id="go"><span class="mr-2">Go</span><a href="#go" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>使用 pprof 工具，可以查看 CPU 占用、排查内存泄漏、协程泄漏等。</p><h1 id="互斥锁和自旋锁">互斥锁和自旋锁</h1><ol><li>互斥锁是一种阻塞锁，获取不到锁的时候，线程会被挂起。<li>自旋锁是一种非阻塞锁，获取不到锁的时候，线程不会被挂起，而且不断去获取，消耗 CPU 资源。</ol><h1 id="缓存-io直接-io裸-io">缓存 IO，直接 IO，裸 IO</h1><ul><li>缓存IO：读数据时先从内核空间的缓冲区读，如果没有则从磁盘中读并缓存到缓冲区；写数据将用户空间的数据复制到内核空间的缓冲区，并标记为脏页，操作系统后台将脏页写入磁盘中，一般用于频繁读写的小文件；<li>直接IO：直接读写文件，而不经过内核缓冲区，目的是减少一次内核缓冲区到用户程序缓存的数据复制，一般用于不需要频繁读写的大文件；<li>裸IO：绕过文件系统，直接读写磁盘块设备数据，一般用于数据库；</ul><h1 id="base64-和-base62-的区别">Base64 和 Base62 的区别</h1><h2 id="编码"><span class="mr-2">编码</span><a href="#编码" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Base64：26 个大写字母 + 26 个小写字母 + 10 个数字 + <code class="language-plaintext highlighter-rouge">+</code> + <code class="language-plaintext highlighter-rouge">/</code>；并不适合直接放在URL里传输，因为URL编码器会把标准Base64中的「/」和「+」字符变为形如「%XX」的形式。<li>Base62：26 个大写字母 + 26 个小写字母 + 10 个数字。</ol><h2 id="实现"><span class="mr-2">实现</span><a href="#实现" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Base64：将输入字符串按字节切分，取得每个字节对应的二进制值（若不足 8 比特则高位补 0），然后将这些二进制数值串联起来，再按照 6 比特一组进行切分（因为 2^6=64），最后一组若不足 6 比特则末尾补 0。若原字节序列数据长度不是 3 的倍数时且剩下 1 个输入数据，则在编码结果后加 2 个 =；若剩下 2 个输入数据，则在编码结果后加 1 个 =。将每组二进制值转换成十进制，然后找到对应的符号并串联起来就是 Base64 编码结果。<li>Base62：将输入字符串哈希后转成长整型，再用<strong>62进制</strong>编码成Base62格式。</ol><h1 id="xxl-job-定时任务框架">XXL-JOB 定时任务框架</h1><p>说到底，定时器还是靠线程轮询实现的。</p><h2 id="调度器"><span class="mr-2">调度器</span><a href="#调度器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>负责下发任务、执行器管理、日志管理等。</p><h2 id="执行器"><span class="mr-2">执行器</span><a href="#执行器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>负责执行任务、心跳检测、结果回调等。</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/backend/" class="post-tag no-text-decoration" >backend</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Note%20from%20Work%20-%20Blogs&url=%2Fposts%2Fnote-from-work%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Note%20from%20Work%20-%20Blogs&u=%2Fposts%2Fnote-from-work%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fnote-from-work%2F&text=Note%20from%20Work%20-%20Blogs" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/elasticsearch/">ElasticSearch</a><li><a href="/posts/note-from-work/">Note from Work</a><li><a href="/posts/redis/">Redis 知识体系</a><li><a href="/posts/springboot/">SpringBoot</a><li><a href="/posts/go/">Go 语言学习</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/springboot/"><div class="card-body"> <em class="small" data-ts="1691651312" data-df="ll" > Aug 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SpringBoot</h3><div class="text-muted small"><p> Spring, SpringBoot, Spring MVC 区别： Spring框架(Framework)是最流行的Java应用程序开发框架。 Spring框架的主要功能是依赖项注入或控制反转(IoC)。 Spring MVC是Spring的一个MVC框架，包含前端视图，文件配置等。XML和config配置比较复杂。 Spring Boot 是为简化Spring配置的快速开发...</p></div></div></a></div><div class="card"> <a href="/posts/kafka-vs-rocketmq/"><div class="card-body"> <em class="small" data-ts="1692954622" data-df="ll" > Aug 25, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kafka vs RocketMQ</h3><div class="text-muted small"><p> 基本概念 RocketMQ 由 Producer, Brocker, Consumer 组成 Producer 负责生产消息 Consumer 负责消费消息 Broker 负责存储消息，每一个 Broker 对应一台服务器但可以存储多个 Topic 的消息，每个 Topic 的消息也分片存储在不同的 Broker 里。 ...</p></div></div></a></div><div class="card"> <a href="/posts/java/"><div class="card-body"> <em class="small" data-ts="1655792594" data-df="ll" > Jun 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basics of Java</h3><div class="text-muted small"><p> 基本知识 三大特点：封装继承多态。 语法糖：switch支持String、泛型、自动拆装箱、变长参数、枚举、内部类、条件编译、断言、数值下划线、for-each、try-with-resources、Lambda表达式 装箱：Integer i = Integer.valueOf(10)， 拆箱：int n = i.intValue() 反射：指动态获取的信息以及动态调用对象的方法的...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/kafka-vs-rocketmq/" class="btn btn-outline-primary" prompt="Older"><p>Kafka vs RocketMQ</p></a> <a href="/posts/go/" class="btn btn-outline-primary" prompt="Newer"><p>Go 语言学习</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "CompetitiveLin/CompetitiveLin.github.io", "data-repo-id": "R_kgDOG9EeyQ", "data-category": "General", "data-category-id": "DIC_kwDOG9Eeyc4CN-ne", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/c/">c++</a> <a class="post-tag" href="/tags/syntax/">syntax</a> <a class="post-tag" href="/tags/windows-10/">windows 10</a> <a class="post-tag" href="/tags/getting-started/">getting started</a> <a class="post-tag" href="/tags/branch/">branch</a> <a class="post-tag" href="/tags/commits/">commits</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/CompetitiveLin">CompetitiveLin</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
